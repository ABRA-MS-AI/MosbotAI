{"version":3,"mappings":"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","names":["appLogo","appServicesAuthTokenUrl","appServicesAuthTokenRefreshUrl","appServicesAuthLogoutUrl","fetchAuthSetup","response","authSetup","useLogin","requireAccessControl","enableUnauthenticatedAccess","requireLogin","msalConfig","loginRequest","tokenRequest","getRedirectUri","getAppServicesToken","checkNotExpired","appServicesToken","currentDate","getAppServicesTokenFromMe","r","json","acc","item","token","isUsingAppServicesLogin","appServicesLogout","checkLoggedIn","client","getToken","error","getUsername","activeAccount","getTokenClaims","BACKEND_URI","getHeaders","idToken","configApi","askApi","request","headers","parsedResponse","chatApi","shouldStream","url","getSpeechApi","text","blob","getCitationFilePath","citation","uploadFileApi","deleteUploadedFileApi","filename","listUploadedFilesApi","postChatHistoryApi","getChatHistoryListApi","count","continuationToken","getChatHistoryApi","id","deleteChatHistoryApi","RetrievalMode","GPT4VInput","VectorFields","isCitationValid","contextDataPoints","citationCandidate","dataPointsArray","dataPoint","parseAnswerToHtml","answer","isStreaming","onCitationClicked","citations","parsedAnswer","lastIndex","i","part","index","citationIndex","path","renderToStaticMarkup","jsx","AnswerIcon","Sparkle28Filled","supportedLngs","i18next","HttpApi","LanguageDetector","initReactI18next","daTranslation","enTranslation","esTranslation","frTranslation","heTranslation","jaTranslation","nlTranslation","ptBRTranslation","trTranslation","itTranslation","SpeechSynthesis","synth","getUtterance","lngCode","utterance","voice","SpeechOutputBrowser","i18n","useTranslation","currentLng","isPlaying","setIsPlaying","useState","startOrStopSpeech","color","IconButton","SpeechOutputAzure","speechConfig","isLoading","setIsLoading","localPlayingState","setLocalPlayingState","t","playAudio","speechUrl","jsxs","Fragment","Answer","isSelected","onThoughtProcessClicked","onSupportingContentClicked","onFollowupQuestionClicked","showFollowupQuestions","showSpeechOutputAzure","showSpeechOutputBrowser","followupQuestions","useMemo","sanitizedAnswerHtml","DOMPurify","copied","setCopied","handleCopy","textToCopy","err","Stack","styles","ReactMarkdown","rehypeRaw","remarkGfm","x","AnswerLoading","animatedStyles","useSpring","animated","AnswerError","onRetry","ErrorCircle24Regular","PrimaryButton","useCustomSpeechRecognition","SpeechRecognition","speechRecognition","SpeechInput","updateQuestion","isRecording","setIsRecording","startRecording","event","input","result","stopRecording","Tooltip","Button","Mic28Filled","LoginContext","createContext","_","QuestionInput","onSend","disabled","placeholder","clearOnSend","initQuestion","showSpeechInput","question","setQuestion","loggedIn","useContext","isComposing","setIsComposing","useEffect","sendQuestion","onEnterPress","ev","handleCompositionStart","handleCompositionEnd","onQuestionChange","_ev","newValue","disableRequiredAccessControl","sendQuestionDisabled","TextField","Send28Filled","Example","value","onClick","ExampleList","onExampleClicked","useGPT4V","DEFAULT_EXAMPLES","GPT4V_EXAMPLES","UserChatMessage","message","parseSupportingContentItem","parts","title","content","SupportingContent","supportingContent","textItems","imageItems","c","ind","parsed","img","AnalysisPanelTabs","TokenUsageGraph","tokenUsage","reasoningEffort","prompt_tokens","completion_tokens","reasoning_tokens","total_tokens","calcPercent","SyntaxHighlighter","AgentPlan","query_plan","description","planning","step","queries","q","ThoughtProcess","thoughts","k","a11yLight","MarkdownViewer","src","setContent","setError","removeAnchorLinks","markdown","ancorLinksRegex","markdownText","Spinner","SpinnerSize","MessageBar","MessageBarType","Link","pivotItemDisabledStyle","AnalysisPanel","activeTab","activeCitation","citationHeight","className","onActiveTabChanged","isDisabledThoughtProcessTab","isDisabledSupportingContentTab","isDisabledCitationTab","setCitation","useMsal","fetchCitation","originalHash","citationContent","citationObjectUrl","renderFileViewer","Pivot","pivotItem","PivotItem","HistoryItem","onSelect","onDelete","isModalOpen","setIsModalOpen","handleDelete","useCallback","Delete24Regular","DeleteHistoryModal","isOpen","onClose","onConfirm","DefaultButton","HistoryProviderOptions","NoneProvider","answers","IndexedDBProvider","dbName","storeName","openDB","db","cursor","loadedItems","timestamp","tx","current","CosmosDBProvider","session","e","useHistoryManager","provider","HISTORY_COUNT_PER_LOAD","HistoryPanel","notify","onChatSelected","historyManager","history","setHistory","hasMoreHistory","setHasMoreHistory","loadMoreHistory","items","prevHistory","handleSelect","groupedHistory","groupHistory","Panel","PanelType","group","InfiniteLoadingButton","today","yesterday","lastWeek","lastMonth","groups","itemDate","func","buttonRef","useRef","observer","entries","entry","HistoryButton","History24Regular","SettingsButton","Settings24Regular","ClearChatButton","UploadFile","isCalloutVisible","setIsCalloutVisible","isUploading","setIsUploading","deletionStatus","setDeletionStatus","uploadedFile","setUploadedFile","uploadedFileError","setUploadedFileError","uploadedFiles","setUploadedFiles","handleButtonClick","listUploadedFiles","files","handleRemoveFile","handleUploadFile","file","formData","Add24Regular","Callout","Label","Text","TokenClaimsDisplay","instance","claims","setClaims","ToString","a","o","key","originalKey","columns","createTableColumn","b","DataGrid","DataGridHeader","DataGridRow","renderHeaderCell","DataGridHeaderCell","DataGridBody","rowId","renderCell","DataGridCell","LanguagePicker","onLanguageChange","handleLanguageChange","option","languagePickerId","useId","LocalLanguage24Regular","Dropdown","code","details","stackTokens","labelCalloutStackStyles","iconButtonStyles","iconProps","HelpCallout","props","toggleIsCalloutVisible","useBoolean","descriptionId","iconButtonId","GPT4VSettings","updateGPT4VInputs","updateUseGPT4V","isUseGPT4V","gpt4vInputs","setUseGPT4V","vectorFieldOption","setVectorFieldOption","onuseGPT4V","checked","onSetGPT4VInput","data","useGPT4VId","useGPT4VFieldId","gpt4VInputId","gpt4VInputFieldId","Checkbox","VectorSettings","updateRetrievalMode","updateVectorFields","showImageOptions","defaultRetrievalMode","defaultVectorFields","retrievalMode","setRetrievalMode","vectorFields","setVectorFields","onRetrievalModeChange","onVectorFieldsChange","retrievalModeId","retrievalModeFieldId","vectorFieldsId","vectorFieldsFieldId","Settings","promptTemplate","temperature","retrieveCount","maxSubqueryCount","resultsMergeStrategy","seed","minimumSearchScore","minimumRerankerScore","useSemanticRanker","useSemanticCaptions","useQueryRewriting","excludeCategory","includeCategory","gpt4vInput","showSemanticRankerOption","showQueryRewritingOption","showReasoningEffortOption","showGPT4VOptions","showVectorOption","useOidSecurityFilter","useGroupsSecurityFilter","onChange","streamingEnabled","useSuggestFollowupQuestions","promptTemplatePrefix","promptTemplateSuffix","showSuggestFollowupQuestions","showAgenticRetrievalOption","useAgenticRetrieval","promptTemplateId","promptTemplateFieldId","temperatureId","temperatureFieldId","seedId","seedFieldId","agenticRetrievalId","agenticRetrievalFieldId","searchScoreId","searchScoreFieldId","rerankerScoreId","rerankerScoreFieldId","retrieveCountId","retrieveCountFieldId","maxSubqueryCountId","maxSubqueryCountFieldId","resultsMergeStrategyFieldId","includeCategoryId","includeCategoryFieldId","excludeCategoryId","excludeCategoryFieldId","semanticRankerId","semanticRankerFieldId","queryRewritingFieldId","reasoningEffortFieldId","semanticCaptionsId","semanticCaptionsFieldId","useOidSecurityFilterId","useOidSecurityFilterFieldId","useGroupsSecurityFilterId","useGroupsSecurityFilterFieldId","shouldStreamId","shouldStreamFieldId","suggestFollowupQuestionsId","suggestFollowupQuestionsFieldId","renderLabel","labelId","fieldId","helpText","val","Chat","isConfigPanelOpen","setIsConfigPanelOpen","isHistoryPanelOpen","setIsHistoryPanelOpen","setPromptTemplate","setTemperature","setSeed","setMinimumRerankerScore","setMinimumSearchScore","setRetrieveCount","setMaxSubqueryCount","setResultsMergeStrategy","setUseSemanticRanker","setUseQueryRewriting","setReasoningEffort","setStreamingEnabled","setShouldStream","setUseSemanticCaptions","setIncludeCategory","setExcludeCategory","setUseSuggestFollowupQuestions","setUseOidSecurityFilter","setUseGroupsSecurityFilter","setGPT4VInput","lastQuestionRef","chatMessageStreamEnd","setIsStreaming","setActiveCitation","activeAnalysisPanelTab","setActiveAnalysisPanelTab","selectedAnswer","setSelectedAnswer","setAnswers","streamedAnswers","setStreamedAnswers","speechUrls","setSpeechUrls","setShowGPT4VOptions","setShowSemanticRankerOption","setShowQueryRewritingOption","setShowReasoningEffortOption","setShowVectorOption","showUserUpload","setShowUserUpload","showLanguagePicker","setshowLanguagePicker","setShowSpeechInput","setShowSpeechOutputBrowser","setShowSpeechOutputAzure","showChatHistoryBrowser","setShowChatHistoryBrowser","showChatHistoryCosmos","setShowChatHistoryCosmos","setShowAgenticRetrievalOption","setUseAgenticRetrieval","audio","getConfig","config","handleAsyncRequest","responseBody","askResponse","updateState","newContent","resolve","latestResponse","readNDJSONStream","historyProvider","makeApiRequest","clearChat","handleSettingsChange","field","example","onShowCitation","onToggleTab","tab","Helmet","streamedAnswer","newLang","LoginButton","setLoggedIn","username","setUsername","handleLoginPopup","handleLogoutPopup","Layout","menuOpen","setMenuOpen","menuRef","toggleMenu","handleClickOutside","NavLink","isActive","Outlet","LayoutWrapper","msalInstance","PublicClientApplication","EventType","account","MsalProvider","initializeIcons","router","createHashRouter","__vitePreload","ReactDOM","React","I18nextProvider","HelmetProvider","RouterProvider"],"ignoreList":[],"sources":["../../../frontend/src/assets/applogo.svg","../../../frontend/src/authConfig.ts","../../../frontend/src/api/api.ts","../../../frontend/src/api/models.ts","../../../frontend/src/components/Answer/AnswerParser.tsx","../../../frontend/src/components/Answer/AnswerIcon.tsx","../../../frontend/src/i18n/config.ts","../../../frontend/src/components/Answer/SpeechOutputBrowser.tsx","../../../frontend/src/components/Answer/SpeechOutputAzure.tsx","../../../frontend/src/components/Answer/Answer.tsx","../../../frontend/src/components/Answer/AnswerLoading.tsx","../../../frontend/src/components/Answer/AnswerError.tsx","../../../frontend/src/components/QuestionInput/SpeechInput.tsx","../../../frontend/src/loginContext.tsx","../../../frontend/src/components/QuestionInput/QuestionInput.tsx","../../../frontend/src/components/Example/Example.tsx","../../../frontend/src/components/Example/ExampleList.tsx","../../../frontend/src/components/UserChatMessage/UserChatMessage.tsx","../../../frontend/src/components/SupportingContent/SupportingContentParser.ts","../../../frontend/src/components/SupportingContent/SupportingContent.tsx","../../../frontend/src/components/AnalysisPanel/AnalysisPanelTabs.tsx","../../../frontend/src/components/AnalysisPanel/TokenUsageGraph.tsx","../../../frontend/src/components/AnalysisPanel/AgentPlan.tsx","../../../frontend/src/components/AnalysisPanel/ThoughtProcess.tsx","../../../frontend/src/components/MarkdownViewer/MarkdownViewer.tsx","../../../frontend/src/components/AnalysisPanel/AnalysisPanel.tsx","../../../frontend/src/components/HistoryItem/HistoryItem.tsx","../../../frontend/src/components/HistoryProviders/IProvider.ts","../../../frontend/src/components/HistoryProviders/None.ts","../../../frontend/src/components/HistoryProviders/IndexedDB.ts","../../../frontend/src/components/HistoryProviders/CosmosDB.ts","../../../frontend/src/components/HistoryProviders/HistoryManager.ts","../../../frontend/src/components/HistoryPanel/HistoryPanel.tsx","../../../frontend/src/components/HistoryButton/HistoryButton.tsx","../../../frontend/src/components/SettingsButton/SettingsButton.tsx","../../../frontend/src/components/ClearChatButton/ClearChatButton.tsx","../../../frontend/src/components/UploadFile/UploadFile.tsx","../../../frontend/src/components/TokenClaimsDisplay/TokenClaimsDisplay.tsx","../../../frontend/src/i18n/LanguagePicker.tsx","../../../frontend/src/components/HelpCallout/HelpCallout.tsx","../../../frontend/src/components/GPT4VSettings/GPT4VSettings.tsx","../../../frontend/src/components/VectorSettings/VectorSettings.tsx","../../../frontend/src/components/Settings/Settings.tsx","../../../frontend/src/pages/chat/Chat.tsx","../../../frontend/src/components/LoginButton/LoginButton.tsx","../../../frontend/src/pages/layout/Layout.tsx","../../../frontend/src/layoutWrapper.tsx","../../../frontend/src/index.tsx"],"sourcesContent":["export default \"data:image/svg+xml,%3csvg%20font-size='120px'%20aria-hidden='true'%20aria-label='Chat%20logo'%20fill='rgba(115,%20118,%20225,%201)'%20class='___12fm75w%20f1w7gpdv%20fez10in%20fg4l7m0'%20role='img'%20width='1em'%20height='1em'%20viewBox='0%200%2020%2020'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M7.4%2012.8a1.04%201.04%200%200%200%201.59-.51l.45-1.37a2.34%202.34%200%200%201%201.47-1.48l1.4-.45A1.04%201.04%200%200%200%2012.25%207l-1.37-.45A2.34%202.34%200%200%201%209.4%205.08L8.95%203.7a1.03%201.03%200%200%200-.82-.68%201.04%201.04%200%200%200-1.15.7l-.46%201.4a2.34%202.34%200%200%201-1.44%201.45L3.7%207a1.04%201.04%200%200%200%20.02%201.97l1.37.45a2.33%202.33%200%200%201%201.48%201.48l.46%201.4c.07.2.2.37.38.5Zm6.14%204.05a.8.8%200%200%200%201.22-.4l.25-.76a1.09%201.09%200%200%201%20.68-.68l.77-.25a.8.8%200%200%200-.02-1.52l-.77-.25a1.08%201.08%200%200%201-.68-.68l-.25-.77a.8.8%200%200%200-1.52.01l-.24.76a1.1%201.1%200%200%201-.67.68l-.77.25a.8.8%200%200%200%200%201.52l.77.25a1.09%201.09%200%200%201%20.68.68l.25.77c.06.16.16.3.3.4Z'%20fill='rgba(115,%20118,%20225,%201)'%3e%3c/path%3e%3c/svg%3e\"","// Refactored from https://github.com/Azure-Samples/ms-identity-javascript-react-tutorial/blob/main/1-Authentication/1-sign-in/SPA/src/authConfig.js\n\nimport { IPublicClientApplication } from \"@azure/msal-browser\";\n\nconst appServicesAuthTokenUrl = \".auth/me\";\nconst appServicesAuthTokenRefreshUrl = \".auth/refresh\";\nconst appServicesAuthLogoutUrl = \".auth/logout?post_logout_redirect_uri=/\";\n\ninterface AppServicesToken {\n    id_token: string;\n    access_token: string;\n    user_claims: Record<string, any>;\n    expires_on: string;\n}\n\ninterface AuthSetup {\n    // Set to true if login elements should be shown in the UI\n    useLogin: boolean;\n    // Set to true if access control is enforced by the application\n    requireAccessControl: boolean;\n    // Set to true if the application allows unauthenticated access (only applies for documents without access control)\n    enableUnauthenticatedAccess: boolean;\n    /**\n     * Configuration object to be passed to MSAL instance on creation.\n     * For a full list of MSAL.js configuration parameters, visit:\n     * https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-browser/docs/configuration.md\n     */\n    msalConfig: {\n        auth: {\n            clientId: string; // Client app id used for login\n            authority: string; // Directory to use for login https://learn.microsoft.com/entra/identity-platform/msal-client-application-configuration#authority\n            redirectUri: string; // Points to window.location.origin. You must register this URI on Azure Portal/App Registration.\n            postLogoutRedirectUri: string; // Indicates the page to navigate after logout.\n            navigateToLoginRequestUrl: boolean; // If \"true\", will navigate back to the original request location before processing the auth code response.\n        };\n        cache: {\n            cacheLocation: string; // Configures cache location. \"sessionStorage\" is more secure, but \"localStorage\" gives you SSO between tabs.\n            storeAuthStateInCookie: boolean; // Set this to \"true\" if you are having issues on IE11 or Edge\n        };\n    };\n    loginRequest: {\n        /**\n         * Scopes you add here will be prompted for user consent during sign-in.\n         * By default, MSAL.js will add OIDC scopes (openid, profile, email) to any login request.\n         * For more information about OIDC scopes, visit:\n         * https://learn.microsoft.com/entra/identity-platform/permissions-consent-overview#openid-connect-scopes\n         */\n        scopes: Array<string>;\n    };\n    tokenRequest: {\n        scopes: Array<string>;\n    };\n}\n\n// Fetch the auth setup JSON data from the API if not already cached\nasync function fetchAuthSetup(): Promise<AuthSetup> {\n    const response = await fetch(\"/auth_setup\");\n    if (!response.ok) {\n        throw new Error(`auth setup response was not ok: ${response.status}`);\n    }\n    return await response.json();\n}\n\nconst authSetup = await fetchAuthSetup();\n\nexport const useLogin = authSetup.useLogin;\n\nexport const requireAccessControl = authSetup.requireAccessControl;\n\nexport const enableUnauthenticatedAccess = authSetup.enableUnauthenticatedAccess;\n\nexport const requireLogin = requireAccessControl && !enableUnauthenticatedAccess;\n\n/**\n * Configuration object to be passed to MSAL instance on creation.\n * For a full list of MSAL.js configuration parameters, visit:\n * https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-browser/docs/configuration.md\n */\nexport const msalConfig = authSetup.msalConfig;\n\n/**\n * Scopes you add here will be prompted for user consent during sign-in.\n * By default, MSAL.js will add OIDC scopes (openid, profile, email) to any login request.\n * For more information about OIDC scopes, visit:\n * https://learn.microsoft.com/entra/identity-platform/permissions-consent-overview#openid-connect-scopes\n */\nexport const loginRequest = authSetup.loginRequest;\n\nconst tokenRequest = authSetup.tokenRequest;\n\n// Build an absolute redirect URI using the current window's location and the relative redirect URI from auth setup\nexport const getRedirectUri = () => {\n    return window.location.origin + authSetup.msalConfig.auth.redirectUri;\n};\n\n// Cache the app services token if it's available\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this#global_context\ndeclare global {\n    var cachedAppServicesToken: AppServicesToken | null;\n}\nglobalThis.cachedAppServicesToken = null;\n\n/**\n * Retrieves an access token if the user is logged in using app services authentication.\n * Checks if the current token is expired and fetches a new token if necessary.\n * Returns null if the app doesn't support app services authentication.\n *\n * @returns {Promise<AppServicesToken | null>} A promise that resolves to an AppServicesToken if the user is authenticated, or null if authentication is not supported or fails.\n */\nconst getAppServicesToken = (): Promise<AppServicesToken | null> => {\n    const checkNotExpired = (appServicesToken: AppServicesToken) => {\n        const currentDate = new Date();\n        const expiresOnDate = new Date(appServicesToken.expires_on);\n        return expiresOnDate > currentDate;\n    };\n\n    if (globalThis.cachedAppServicesToken && checkNotExpired(globalThis.cachedAppServicesToken)) {\n        return Promise.resolve(globalThis.cachedAppServicesToken);\n    }\n\n    const getAppServicesTokenFromMe: () => Promise<AppServicesToken | null> = () => {\n        return fetch(appServicesAuthTokenUrl).then(r => {\n            if (r.ok) {\n                return r.json().then(json => {\n                    if (json.length > 0) {\n                        return {\n                            id_token: json[0][\"id_token\"] as string,\n                            access_token: json[0][\"access_token\"] as string,\n                            user_claims: json[0][\"user_claims\"].reduce((acc: Record<string, any>, item: Record<string, any>) => {\n                                acc[item.typ] = item.val;\n                                return acc;\n                            }, {}) as Record<string, any>,\n                            expires_on: json[0][\"expires_on\"] as string\n                        } as AppServicesToken;\n                    }\n\n                    return null;\n                });\n            }\n\n            return null;\n        });\n    };\n\n    return getAppServicesTokenFromMe().then(token => {\n        if (token) {\n            if (checkNotExpired(token)) {\n                globalThis.cachedAppServicesToken = token;\n                return token;\n            }\n\n            return fetch(appServicesAuthTokenRefreshUrl).then(r => {\n                if (r.ok) {\n                    return getAppServicesTokenFromMe();\n                }\n                return null;\n            });\n        }\n\n        return null;\n    });\n};\n\nexport const isUsingAppServicesLogin = (await getAppServicesToken()) != null;\n\n// Sign out of app services\n// Learn more at https://learn.microsoft.com/azure/app-service/configure-authentication-customize-sign-in-out#sign-out-of-a-session\nexport const appServicesLogout = () => {\n    window.location.href = appServicesAuthLogoutUrl;\n};\n\n/**\n * Determines if the user is logged in either via the MSAL public client application or the app services login.\n * @param {IPublicClientApplication | undefined} client - The MSAL public client application instance, or undefined if not available.\n * @returns {Promise<boolean>} A promise that resolves to true if the user is logged in, false otherwise.\n */\nexport const checkLoggedIn = async (client: IPublicClientApplication | undefined): Promise<boolean> => {\n    if (client) {\n        const activeAccount = client.getActiveAccount();\n        if (activeAccount) {\n            return true;\n        }\n    }\n\n    const appServicesToken = await getAppServicesToken();\n    if (appServicesToken) {\n        return true;\n    }\n\n    return false;\n};\n\n// Get an access token for use with the API server.\n// ID token received when logging in may not be used for this purpose because it has the incorrect audience\n// Use the access token from app services login if available\nexport const getToken = async (client: IPublicClientApplication): Promise<string | undefined> => {\n    const appServicesToken = await getAppServicesToken();\n    if (appServicesToken) {\n        return Promise.resolve(appServicesToken.access_token);\n    }\n\n    return client\n        .acquireTokenSilent({\n            ...tokenRequest,\n            redirectUri: getRedirectUri()\n        })\n        .then(r => r.accessToken)\n        .catch(error => {\n            console.log(error);\n            return undefined;\n        });\n};\n\n/**\n * Retrieves the username of the active account.\n * If no active account is found, attempts to retrieve the username from the app services login token if available.\n * @param {IPublicClientApplication} client - The MSAL public client application instance.\n * @returns {Promise<string | null>} The username of the active account, or null if no username is found.\n */\nexport const getUsername = async (client: IPublicClientApplication): Promise<string | null> => {\n    const activeAccount = client.getActiveAccount();\n    if (activeAccount) {\n        return activeAccount.username;\n    }\n\n    const appServicesToken = await getAppServicesToken();\n    if (appServicesToken?.user_claims) {\n        return appServicesToken.user_claims.preferred_username;\n    }\n\n    return null;\n};\n\n/**\n * Retrieves the token claims of the active account.\n * If no active account is found, attempts to retrieve the token claims from the app services login token if available.\n * @param {IPublicClientApplication} client - The MSAL public client application instance.\n * @returns {Promise<Record<string, unknown> | undefined>} A promise that resolves to the token claims of the active account, the user claims from the app services login token, or undefined if no claims are found.\n */\nexport const getTokenClaims = async (client: IPublicClientApplication): Promise<Record<string, unknown> | undefined> => {\n    const activeAccount = client.getActiveAccount();\n    if (activeAccount) {\n        return activeAccount.idTokenClaims;\n    }\n\n    const appServicesToken = await getAppServicesToken();\n    if (appServicesToken) {\n        return appServicesToken.user_claims;\n    }\n\n    return undefined;\n};\n","const BACKEND_URI = \"\";\n\nimport { ChatAppResponse, ChatAppResponseOrError, ChatAppRequest, Config, SimpleAPIResponse, HistoryListApiResponse, HistoryApiResponse } from \"./models\";\nimport { useLogin, getToken, isUsingAppServicesLogin } from \"../authConfig\";\n\nexport async function getHeaders(idToken: string | undefined): Promise<Record<string, string>> {\n    // If using login and not using app services, add the id token of the logged in account as the authorization\n    if (useLogin && !isUsingAppServicesLogin) {\n        if (idToken) {\n            return { Authorization: `Bearer ${idToken}` };\n        }\n    }\n\n    return {};\n}\n\nexport async function configApi(): Promise<Config> {\n    const response = await fetch(`${BACKEND_URI}/config`, {\n        method: \"GET\"\n    });\n\n    return (await response.json()) as Config;\n}\n\nexport async function askApi(request: ChatAppRequest, idToken: string | undefined): Promise<ChatAppResponse> {\n    const headers = await getHeaders(idToken);\n    const response = await fetch(`${BACKEND_URI}/ask`, {\n        method: \"POST\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(request)\n    });\n\n    if (response.status > 299 || !response.ok) {\n        throw Error(`Request failed with status ${response.status}`);\n    }\n    const parsedResponse: ChatAppResponseOrError = await response.json();\n    if (parsedResponse.error) {\n        throw Error(parsedResponse.error);\n    }\n\n    return parsedResponse as ChatAppResponse;\n}\n\nexport async function chatApi(request: ChatAppRequest, shouldStream: boolean, idToken: string | undefined): Promise<Response> {\n    let url = `${BACKEND_URI}/chat`;\n    if (shouldStream) {\n        url += \"/stream\";\n    }\n    const headers = await getHeaders(idToken);\n    return await fetch(url, {\n        method: \"POST\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(request)\n    });\n}\n\nexport async function getSpeechApi(text: string): Promise<string | null> {\n    return await fetch(\"/speech\", {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            text: text\n        })\n    })\n        .then(response => {\n            if (response.status == 200) {\n                return response.blob();\n            } else if (response.status == 400) {\n                console.log(\"Speech synthesis is not enabled.\");\n                return null;\n            } else {\n                console.error(\"Unable to get speech synthesis.\");\n                return null;\n            }\n        })\n        .then(blob => (blob ? URL.createObjectURL(blob) : null));\n}\n\nexport function getCitationFilePath(citation: string): string {\n    return `${BACKEND_URI}/content/${citation}`;\n}\n\nexport async function uploadFileApi(request: FormData, idToken: string): Promise<SimpleAPIResponse> {\n    const response = await fetch(\"/upload\", {\n        method: \"POST\",\n        headers: await getHeaders(idToken),\n        body: request\n    });\n\n    if (!response.ok) {\n        throw new Error(`Uploading files failed: ${response.statusText}`);\n    }\n\n    const dataResponse: SimpleAPIResponse = await response.json();\n    return dataResponse;\n}\n\nexport async function deleteUploadedFileApi(filename: string, idToken: string): Promise<SimpleAPIResponse> {\n    const headers = await getHeaders(idToken);\n    const response = await fetch(\"/delete_uploaded\", {\n        method: \"POST\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ filename })\n    });\n\n    if (!response.ok) {\n        throw new Error(`Deleting file failed: ${response.statusText}`);\n    }\n\n    const dataResponse: SimpleAPIResponse = await response.json();\n    return dataResponse;\n}\n\nexport async function listUploadedFilesApi(idToken: string): Promise<string[]> {\n    const response = await fetch(`/list_uploaded`, {\n        method: \"GET\",\n        headers: await getHeaders(idToken)\n    });\n\n    if (!response.ok) {\n        throw new Error(`Listing files failed: ${response.statusText}`);\n    }\n\n    const dataResponse: string[] = await response.json();\n    return dataResponse;\n}\n\nexport async function postChatHistoryApi(item: any, idToken: string): Promise<any> {\n    const headers = await getHeaders(idToken);\n    const response = await fetch(\"/chat_history\", {\n        method: \"POST\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(item)\n    });\n\n    if (!response.ok) {\n        throw new Error(`Posting chat history failed: ${response.statusText}`);\n    }\n\n    const dataResponse: any = await response.json();\n    return dataResponse;\n}\n\nexport async function getChatHistoryListApi(count: number, continuationToken: string | undefined, idToken: string): Promise<HistoryListApiResponse> {\n    const headers = await getHeaders(idToken);\n    let url = `${BACKEND_URI}/chat_history/sessions?count=${count}`;\n    if (continuationToken) {\n        url += `&continuationToken=${continuationToken}`;\n    }\n\n    const response = await fetch(url.toString(), {\n        method: \"GET\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" }\n    });\n\n    if (!response.ok) {\n        throw new Error(`Getting chat histories failed: ${response.statusText}`);\n    }\n\n    const dataResponse: HistoryListApiResponse = await response.json();\n    return dataResponse;\n}\n\nexport async function getChatHistoryApi(id: string, idToken: string): Promise<HistoryApiResponse> {\n    const headers = await getHeaders(idToken);\n    const response = await fetch(`/chat_history/sessions/${id}`, {\n        method: \"GET\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" }\n    });\n\n    if (!response.ok) {\n        throw new Error(`Getting chat history failed: ${response.statusText}`);\n    }\n\n    const dataResponse: HistoryApiResponse = await response.json();\n    return dataResponse;\n}\n\nexport async function deleteChatHistoryApi(id: string, idToken: string): Promise<any> {\n    const headers = await getHeaders(idToken);\n    const response = await fetch(`/chat_history/sessions/${id}`, {\n        method: \"DELETE\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" }\n    });\n\n    if (!response.ok) {\n        throw new Error(`Deleting chat history failed: ${response.statusText}`);\n    }\n}\n","export const enum RetrievalMode {\n    Hybrid = \"hybrid\",\n    Vectors = \"vectors\",\n    Text = \"text\"\n}\n\nexport const enum GPT4VInput {\n    TextAndImages = \"textAndImages\",\n    Images = \"images\",\n    Texts = \"texts\"\n}\n\nexport const enum VectorFields {\n    Embedding = \"textEmbeddingOnly\",\n    ImageEmbedding = \"imageEmbeddingOnly\",\n    TextAndImageEmbeddings = \"textAndImageEmbeddings\"\n}\n\nexport type ChatAppRequestOverrides = {\n    retrieval_mode?: RetrievalMode;\n    semantic_ranker?: boolean;\n    semantic_captions?: boolean;\n    query_rewriting?: boolean;\n    reasoning_effort?: string;\n    include_category?: string;\n    exclude_category?: string;\n    seed?: number;\n    top?: number;\n    max_subqueries?: number;\n    results_merge_strategy?: string;\n    temperature?: number;\n    minimum_search_score?: number;\n    minimum_reranker_score?: number;\n    prompt_template?: string;\n    prompt_template_prefix?: string;\n    prompt_template_suffix?: string;\n    suggest_followup_questions?: boolean;\n    use_oid_security_filter?: boolean;\n    use_groups_security_filter?: boolean;\n    use_gpt4v?: boolean;\n    gpt4v_input?: GPT4VInput;\n    vector_fields: VectorFields;\n    language: string;\n    use_agentic_retrieval: boolean;\n};\n\nexport type ResponseMessage = {\n    content: string;\n    role: string;\n};\n\nexport type Thoughts = {\n    title: string;\n    description: any; // It can be any output from the api\n    props?: { [key: string]: any };\n};\n\nexport type ResponseContext = {\n    data_points: string[];\n    followup_questions: string[] | null;\n    thoughts: Thoughts[];\n};\n\nexport type ChatAppResponseOrError = {\n    message: ResponseMessage;\n    delta: ResponseMessage;\n    context: ResponseContext;\n    session_state: any;\n    error?: string;\n};\n\nexport type ChatAppResponse = {\n    message: ResponseMessage;\n    delta: ResponseMessage;\n    context: ResponseContext;\n    session_state: any;\n};\n\nexport type ChatAppRequestContext = {\n    overrides?: ChatAppRequestOverrides;\n};\n\nexport type ChatAppRequest = {\n    messages: ResponseMessage[];\n    context?: ChatAppRequestContext;\n    session_state: any;\n};\n\nexport type Config = {\n    defaultReasoningEffort: string;\n    showGPT4VOptions: boolean;\n    showSemanticRankerOption: boolean;\n    showQueryRewritingOption: boolean;\n    showReasoningEffortOption: boolean;\n    streamingEnabled: boolean;\n    showVectorOption: boolean;\n    showUserUpload: boolean;\n    showLanguagePicker: boolean;\n    showSpeechInput: boolean;\n    showSpeechOutputBrowser: boolean;\n    showSpeechOutputAzure: boolean;\n    showChatHistoryBrowser: boolean;\n    showChatHistoryCosmos: boolean;\n    showAgenticRetrievalOption: boolean;\n};\n\nexport type SimpleAPIResponse = {\n    message?: string;\n};\n\nexport interface SpeechConfig {\n    speechUrls: (string | null)[];\n    setSpeechUrls: (urls: (string | null)[]) => void;\n    audio: HTMLAudioElement;\n    isPlaying: boolean;\n    setIsPlaying: (isPlaying: boolean) => void;\n}\n\nexport type HistoryListApiResponse = {\n    sessions: {\n        id: string;\n        entra_oid: string;\n        title: string;\n        timestamp: number;\n    }[];\n    continuation_token?: string;\n};\n\nexport type HistoryApiResponse = {\n    id: string;\n    entra_oid: string;\n    answers: any;\n};\n","import { renderToStaticMarkup } from \"react-dom/server\";\nimport { ChatAppResponse, getCitationFilePath } from \"../../api\";\n\ntype HtmlParsedAnswer = {\n    answerHtml: string;\n    citations: string[];\n};\n\n// Function to validate citation format and check if dataPoint starts with possible citation\nfunction isCitationValid(contextDataPoints: any, citationCandidate: string): boolean {\n    const regex = /.+\\.\\w{1,}(?:#\\S*)?$/;\n    if (!regex.test(citationCandidate)) {\n        return false;\n    }\n\n    // Check if contextDataPoints is an object with a text property that is an array\n    let dataPointsArray: string[];\n    if (Array.isArray(contextDataPoints)) {\n        dataPointsArray = contextDataPoints;\n    } else if (contextDataPoints && Array.isArray(contextDataPoints.text)) {\n        dataPointsArray = contextDataPoints.text;\n    } else {\n        return false;\n    }\n\n    const isValidCitation = dataPointsArray.some(dataPoint => {\n        return dataPoint.startsWith(citationCandidate);\n    });\n\n    return isValidCitation;\n}\n\nexport function parseAnswerToHtml(answer: ChatAppResponse, isStreaming: boolean, onCitationClicked: (citationFilePath: string) => void): HtmlParsedAnswer {\n    const contextDataPoints = answer.context.data_points;\n    const citations: string[] = [];\n\n    // Trim any whitespace from the end of the answer after removing follow-up questions\n    let parsedAnswer = answer.message.content.trim();\n\n    // Omit a citation that is still being typed during streaming\n    if (isStreaming) {\n        let lastIndex = parsedAnswer.length;\n        for (let i = parsedAnswer.length - 1; i >= 0; i--) {\n            if (parsedAnswer[i] === \"]\") {\n                break;\n            } else if (parsedAnswer[i] === \"[\") {\n                lastIndex = i;\n                break;\n            }\n        }\n        const truncatedAnswer = parsedAnswer.substring(0, lastIndex);\n        parsedAnswer = truncatedAnswer;\n    }\n\n    const parts = parsedAnswer.split(/\\[([^\\]]+)\\]/g);\n\n    const fragments: string[] = parts.map((part, index) => {\n        if (index % 2 === 0) {\n            return part;\n        } else {\n            let citationIndex: number;\n\n            if (!isCitationValid(contextDataPoints, part)) {\n                return `[${part}]`;\n            }\n\n            if (citations.indexOf(part) !== -1) {\n                citationIndex = citations.indexOf(part) + 1;\n            } else {\n                citations.push(part);\n                citationIndex = citations.length;\n            }\n\n            const path = getCitationFilePath(part);\n\n            return renderToStaticMarkup(\n                <a className=\"supContainer\" title={part} onClick={() => onCitationClicked(path)}>\n                    <sup>{citationIndex}</sup>\n                </a>\n            );\n        }\n    });\n\n    return {\n        answerHtml: fragments.join(\"\"),\n        citations\n    };\n}\n","import { Sparkle28Filled } from \"@fluentui/react-icons\";\n\nexport const AnswerIcon = () => {\n    return <Sparkle28Filled primaryFill={\"rgba(115, 118, 225, 1)\"} aria-hidden=\"true\" aria-label=\"Answer logo\" />;\n};\n","import i18next from \"i18next\";\nimport LanguageDetector from \"i18next-browser-languagedetector\";\nimport HttpApi from \"i18next-http-backend\";\nimport { initReactI18next } from \"react-i18next\";\n\nimport daTranslation from \"../locales/da/translation.json\";\nimport enTranslation from \"../locales/en/translation.json\";\nimport esTranslation from \"../locales/es/translation.json\";\nimport frTranslation from \"../locales/fr/translation.json\";\nimport heTranslation from \"../locales/he/translation.json\";\nimport jaTranslation from \"../locales/ja/translation.json\";\nimport nlTranslation from \"../locales/nl/translation.json\";\nimport ptBRTranslation from \"../locales/ptBR/translation.json\";\nimport trTranslation from \"../locales/tr/translation.json\";\nimport itTranslation from \"../locales/it/translation.json\";\n\nexport const supportedLngs: { [key: string]: { name: string; locale: string } } = {\n    da: {\n        name: \"Dansk\",\n        locale: \"da-DK\"\n    },\n    en: {\n        name: \"English\",\n        locale: \"en-US\"\n    },\n    es: {\n        name: \"Español\",\n        locale: \"es-ES\"\n    },\n    fr: {\n        name: \"Français\",\n        locale: \"fr-FR\"\n    },\n    he: {\n        name: \"עברית\",\n        locale: \"he-IL\"\n    },\n    ja: {\n        name: \"日本語\",\n        locale: \"ja-JP\"\n    },\n    nl: {\n        name: \"Nederlands\",\n        locale: \"nl-NL\"\n    },\n    ptBR: {\n        name: \"Português Brasileiro\",\n        locale: \"pt-BR\"\n    },\n    tr: {\n        name: \"Türkçe\",\n        locale: \"tr-TR\"\n    },\n    it: {\n        name: \"Italiano\",\n        locale: \"it-IT\"\n    }\n};\n\ni18next\n    .use(HttpApi)\n    .use(LanguageDetector)\n    .use(initReactI18next)\n    // init i18next\n    // for all options read: https://www.i18next.com/overview/configuration-options\n    .init({\n        resources: {\n            da: { translation: daTranslation },\n            en: { translation: enTranslation },\n            es: { translation: esTranslation },\n            fr: { translation: frTranslation },\n            he: { translation: heTranslation },\n            ja: { translation: jaTranslation },\n            nl: { translation: nlTranslation },\n            ptBR: { translation: ptBRTranslation },\n            tr: { translation: trTranslation },\n            it: { translation: itTranslation }\n        },\n        fallbackLng: \"en\",\n        supportedLngs: Object.keys(supportedLngs),\n        debug: import.meta.env.DEV,\n        interpolation: {\n            escapeValue: false // not needed for react as it escapes by default\n        }\n    });\n\nexport default i18next;\n","import { useState } from \"react\";\nimport { IconButton } from \"@fluentui/react\";\nimport { useTranslation } from \"react-i18next\";\nimport { supportedLngs } from \"../../i18n/config\";\n\ninterface Props {\n    answer: string;\n}\n\nconst SpeechSynthesis = (window as any).speechSynthesis || (window as any).webkitSpeechSynthesis;\n\nlet synth: SpeechSynthesis | null = null;\n\ntry {\n    synth = SpeechSynthesis;\n} catch (err) {\n    console.error(\"SpeechSynthesis is not supported\");\n}\n\nconst getUtterance = function (text: string, lngCode: string = \"en-US\") {\n    if (synth) {\n        const utterance = new SpeechSynthesisUtterance(text);\n        utterance.lang = lngCode;\n        utterance.volume = 1;\n        utterance.rate = 1;\n        utterance.pitch = 1;\n\n        let voice = synth.getVoices().filter((voice: SpeechSynthesisVoice) => voice.lang === lngCode)[0];\n        if (!voice) {\n            voice = synth.getVoices().filter((voice: SpeechSynthesisVoice) => voice.lang === \"en-US\")[0];\n        }\n\n        utterance.voice = voice;\n        return utterance;\n    }\n};\n\nexport const SpeechOutputBrowser = ({ answer }: Props) => {\n    const { t, i18n } = useTranslation();\n    const currentLng = i18n.language;\n    let lngCode = supportedLngs[currentLng]?.locale;\n    if (!lngCode) {\n        lngCode = \"en-US\";\n    }\n    const [isPlaying, setIsPlaying] = useState<boolean>(false);\n\n    const startOrStopSpeech = (answer: string) => {\n        if (synth != null) {\n            if (isPlaying) {\n                synth.cancel(); // removes all utterances from the utterance queue.\n                setIsPlaying(false);\n                return;\n            }\n            const utterance: SpeechSynthesisUtterance | undefined = getUtterance(answer, lngCode);\n\n            if (!utterance) {\n                return;\n            }\n\n            synth.speak(utterance);\n\n            utterance.onstart = () => {\n                setIsPlaying(true);\n                return;\n            };\n\n            utterance.onend = () => {\n                setIsPlaying(false);\n                return;\n            };\n        }\n    };\n    const color = isPlaying ? \"red\" : \"black\";\n\n    return (\n        <IconButton\n            style={{ color: color }}\n            iconProps={{ iconName: \"Volume3\" }}\n            title={t(\"tooltips.speakAnswer\")}\n            ariaLabel={t(\"tooltips.speakAnswer\")}\n            onClick={() => startOrStopSpeech(answer)}\n            disabled={!synth}\n        />\n    );\n};\n","import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { IconButton } from \"@fluentui/react\";\nimport { getSpeechApi, SpeechConfig } from \"../../api\";\n\ninterface Props {\n    answer: string;\n    speechConfig: SpeechConfig;\n    index: number;\n    isStreaming: boolean;\n}\n\nexport const SpeechOutputAzure = ({ answer, speechConfig, index, isStreaming }: Props) => {\n    const [isLoading, setIsLoading] = useState(false);\n    const [localPlayingState, setLocalPlayingState] = useState(false);\n    const { t } = useTranslation();\n\n    const playAudio = async (url: string) => {\n        speechConfig.audio.src = url;\n        await speechConfig.audio\n            .play()\n            .then(() => {\n                speechConfig.audio.onended = () => {\n                    speechConfig.setIsPlaying(false);\n                    setLocalPlayingState(false);\n                };\n                speechConfig.setIsPlaying(true);\n                setLocalPlayingState(true);\n            })\n            .catch(() => {\n                alert(\"Failed to play speech output.\");\n                console.error(\"Failed to play speech output.\");\n                speechConfig.setIsPlaying(false);\n                setLocalPlayingState(false);\n            });\n    };\n\n    const startOrStopSpeech = async (answer: string) => {\n        if (speechConfig.isPlaying) {\n            speechConfig.audio.pause();\n            speechConfig.audio.currentTime = 0;\n            speechConfig.setIsPlaying(false);\n            setLocalPlayingState(false);\n            return;\n        }\n        if (speechConfig.speechUrls[index]) {\n            playAudio(speechConfig.speechUrls[index]);\n            return;\n        }\n        setIsLoading(true);\n        await getSpeechApi(answer).then(async speechUrl => {\n            if (!speechUrl) {\n                alert(\"Speech output is not available.\");\n                console.error(\"Speech output is not available.\");\n                return;\n            }\n            setIsLoading(false);\n            speechConfig.setSpeechUrls(speechConfig.speechUrls.map((url, i) => (i === index ? speechUrl : url)));\n            playAudio(speechUrl);\n        });\n    };\n\n    const color = localPlayingState ? \"red\" : \"black\";\n\n    // We always preload the Sync icon in hidden mode so that there's no visual glitch when icon changes\n    return isLoading ? (\n        <IconButton style={{ color: color }} iconProps={{ iconName: \"Sync\" }} title=\"Loading speech\" ariaLabel=\"Loading speech\" disabled={true} />\n    ) : (\n        <>\n            <IconButton iconProps={{ iconName: \"Sync\" }} ariaHidden={true} disabled={true} style={{ display: \"none\" }} />\n            <IconButton\n                style={{ color: color }}\n                iconProps={{ iconName: \"Volume3\" }}\n                title={t(\"tooltips.speakAnswer\")}\n                ariaLabel={t(\"tooltips.speakAnswer\")}\n                onClick={() => startOrStopSpeech(answer)}\n                disabled={isStreaming}\n            />\n        </>\n    );\n};\n","import { useMemo, useState } from \"react\";\nimport { Stack, IconButton } from \"@fluentui/react\";\nimport { useTranslation } from \"react-i18next\";\nimport DOMPurify from \"dompurify\";\nimport ReactMarkdown from \"react-markdown\";\nimport remarkGfm from \"remark-gfm\";\nimport rehypeRaw from \"rehype-raw\";\n\nimport styles from \"./Answer.module.css\";\nimport { ChatAppResponse, getCitationFilePath, SpeechConfig } from \"../../api\";\nimport { parseAnswerToHtml } from \"./AnswerParser\";\nimport { AnswerIcon } from \"./AnswerIcon\";\nimport { SpeechOutputBrowser } from \"./SpeechOutputBrowser\";\nimport { SpeechOutputAzure } from \"./SpeechOutputAzure\";\n\ninterface Props {\n    answer: ChatAppResponse;\n    index: number;\n    speechConfig: SpeechConfig;\n    isSelected?: boolean;\n    isStreaming: boolean;\n    onCitationClicked: (filePath: string) => void;\n    onThoughtProcessClicked: () => void;\n    onSupportingContentClicked: () => void;\n    onFollowupQuestionClicked?: (question: string) => void;\n    showFollowupQuestions?: boolean;\n    showSpeechOutputBrowser?: boolean;\n    showSpeechOutputAzure?: boolean;\n}\n\nexport const Answer = ({\n    answer,\n    index,\n    speechConfig,\n    isSelected,\n    isStreaming,\n    onCitationClicked,\n    onThoughtProcessClicked,\n    onSupportingContentClicked,\n    onFollowupQuestionClicked,\n    showFollowupQuestions,\n    showSpeechOutputAzure,\n    showSpeechOutputBrowser\n}: Props) => {\n    const followupQuestions = answer.context?.followup_questions;\n    const parsedAnswer = useMemo(() => parseAnswerToHtml(answer, isStreaming, onCitationClicked), [answer]);\n    const { t } = useTranslation();\n    const sanitizedAnswerHtml = DOMPurify.sanitize(parsedAnswer.answerHtml);\n    const [copied, setCopied] = useState(false);\n\n    const handleCopy = () => {\n        // Single replace to remove all HTML tags to remove the citations\n        const textToCopy = sanitizedAnswerHtml.replace(/<a [^>]*><sup>\\d+<\\/sup><\\/a>|<[^>]+>/g, \"\");\n\n        navigator.clipboard\n            .writeText(textToCopy)\n            .then(() => {\n                setCopied(true);\n                setTimeout(() => setCopied(false), 2000);\n            })\n            .catch(err => console.error(\"Failed to copy text: \", err));\n    };\n\n    return (\n        <Stack className={`${styles.answerContainer} ${isSelected && styles.selected}`} verticalAlign=\"space-between\">\n            <Stack.Item>\n                <Stack horizontal horizontalAlign=\"space-between\">\n                    <AnswerIcon />\n                    <div>\n                        <IconButton\n                            style={{ color: \"black\" }}\n                            iconProps={{ iconName: copied ? \"CheckMark\" : \"Copy\" }}\n                            title={copied ? t(\"tooltips.copied\") : t(\"tooltips.copy\")}\n                            ariaLabel={copied ? t(\"tooltips.copied\") : t(\"tooltips.copy\")}\n                            onClick={handleCopy}\n                        />\n                        <IconButton\n                            style={{ color: \"black\" }}\n                            iconProps={{ iconName: \"Lightbulb\" }}\n                            title={t(\"tooltips.showThoughtProcess\")}\n                            ariaLabel={t(\"tooltips.showThoughtProcess\")}\n                            onClick={() => onThoughtProcessClicked()}\n                            disabled={!answer.context.thoughts?.length || isStreaming}\n                        />\n                        <IconButton\n                            style={{ color: \"black\" }}\n                            iconProps={{ iconName: \"ClipboardList\" }}\n                            title={t(\"tooltips.showSupportingContent\")}\n                            ariaLabel={t(\"tooltips.showSupportingContent\")}\n                            onClick={() => onSupportingContentClicked()}\n                            disabled={!answer.context.data_points || isStreaming}\n                        />\n                        {showSpeechOutputAzure && (\n                            <SpeechOutputAzure answer={sanitizedAnswerHtml} index={index} speechConfig={speechConfig} isStreaming={isStreaming} />\n                        )}\n                        {showSpeechOutputBrowser && <SpeechOutputBrowser answer={sanitizedAnswerHtml} />}\n                    </div>\n                </Stack>\n            </Stack.Item>\n\n            <Stack.Item grow>\n                <div className={styles.answerText}>\n                    <ReactMarkdown children={sanitizedAnswerHtml} rehypePlugins={[rehypeRaw]} remarkPlugins={[remarkGfm]} />\n                </div>\n            </Stack.Item>\n\n            {!!parsedAnswer.citations.length && (\n                <Stack.Item>\n                    <Stack horizontal wrap tokens={{ childrenGap: 5 }}>\n                        <span className={styles.citationLearnMore}>{t(\"citationWithColon\")}</span>\n                        {parsedAnswer.citations.map((x, i) => {\n                            const path = getCitationFilePath(x);\n                            return (\n                                <a key={i} className={styles.citation} title={x} onClick={() => onCitationClicked(path)}>\n                                    {`${++i}. ${x}`}\n                                </a>\n                            );\n                        })}\n                    </Stack>\n                </Stack.Item>\n            )}\n\n            {!!followupQuestions?.length && showFollowupQuestions && onFollowupQuestionClicked && (\n                <Stack.Item>\n                    <Stack horizontal wrap className={`${!!parsedAnswer.citations.length ? styles.followupQuestionsList : \"\"}`} tokens={{ childrenGap: 6 }}>\n                        <span className={styles.followupQuestionLearnMore}>{t(\"followupQuestions\")}</span>\n                        {followupQuestions.map((x, i) => {\n                            return (\n                                <a key={i} className={styles.followupQuestion} title={x} onClick={() => onFollowupQuestionClicked(x)}>\n                                    {`${x}`}\n                                </a>\n                            );\n                        })}\n                    </Stack>\n                </Stack.Item>\n            )}\n        </Stack>\n    );\n};\n","import { Stack } from \"@fluentui/react\";\nimport { animated, useSpring } from \"@react-spring/web\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./Answer.module.css\";\nimport { AnswerIcon } from \"./AnswerIcon\";\n\nexport const AnswerLoading = () => {\n    const { t, i18n } = useTranslation();\n    const animatedStyles = useSpring({\n        from: { opacity: 0 },\n        to: { opacity: 1 }\n    });\n\n    return (\n        <animated.div style={{ ...animatedStyles }}>\n            <Stack className={styles.answerContainer} verticalAlign=\"space-between\">\n                <AnswerIcon />\n                <Stack.Item grow>\n                    <p className={styles.answerText}>\n                        {t(\"generatingAnswer\")}\n                        <span className={styles.loadingdots} />\n                    </p>\n                </Stack.Item>\n            </Stack>\n        </animated.div>\n    );\n};\n","import { Stack, PrimaryButton } from \"@fluentui/react\";\nimport { ErrorCircle24Regular } from \"@fluentui/react-icons\";\n\nimport styles from \"./Answer.module.css\";\n\ninterface Props {\n    error: string;\n    onRetry: () => void;\n}\n\nexport const AnswerError = ({ error, onRetry }: Props) => {\n    return (\n        <Stack className={styles.answerContainer} verticalAlign=\"space-between\">\n            <ErrorCircle24Regular aria-hidden=\"true\" aria-label=\"Error icon\" primaryFill=\"red\" />\n\n            <Stack.Item grow>\n                <p className={styles.answerText}>{error}</p>\n            </Stack.Item>\n\n            <PrimaryButton className={styles.retryButton} onClick={onRetry} text=\"Retry\" />\n        </Stack>\n    );\n};\n","import { SetStateAction, useState } from \"react\";\nimport { Button, Tooltip } from \"@fluentui/react-components\";\nimport { Mic28Filled } from \"@fluentui/react-icons\";\nimport { useTranslation } from \"react-i18next\";\nimport styles from \"./QuestionInput.module.css\";\nimport { supportedLngs } from \"../../i18n/config\";\n\ninterface Props {\n    updateQuestion: (question: string) => void;\n}\n\nconst useCustomSpeechRecognition = () => {\n    const { i18n } = useTranslation();\n    const currentLng = i18n.language;\n    let lngCode = supportedLngs[currentLng]?.locale;\n    if (!lngCode) {\n        lngCode = \"en-US\";\n    }\n\n    const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\n    let speechRecognition: {\n        continuous: boolean;\n        lang: string;\n        interimResults: boolean;\n        maxAlternatives: number;\n        start: () => void;\n        onresult: (event: { results: { transcript: SetStateAction<string> }[][] }) => void;\n        onend: () => void;\n        onerror: (event: { error: string }) => void;\n        stop: () => void;\n    } | null = null;\n\n    try {\n        speechRecognition = new SpeechRecognition();\n        if (speechRecognition != null) {\n            speechRecognition.lang = lngCode;\n            speechRecognition.interimResults = true;\n        }\n    } catch (err) {\n        console.error(\"SpeechRecognition not supported\");\n        speechRecognition = null;\n    }\n\n    return speechRecognition;\n};\n\nexport const SpeechInput = ({ updateQuestion }: Props) => {\n    let speechRecognition = useCustomSpeechRecognition();\n    const { t } = useTranslation();\n    const [isRecording, setIsRecording] = useState<boolean>(false);\n    const startRecording = () => {\n        if (speechRecognition == null) {\n            console.error(\"SpeechRecognition not supported\");\n            return;\n        }\n\n        speechRecognition.onresult = (event: { results: { transcript: SetStateAction<string> }[][] }) => {\n            let input = \"\";\n            for (const result of event.results) {\n                input += result[0].transcript;\n            }\n            updateQuestion(input);\n        };\n        speechRecognition.onend = () => {\n            // NOTE: In some browsers (e.g. Chrome), the recording will stop automatically after a few seconds of silence.\n            setIsRecording(false);\n        };\n        speechRecognition.onerror = (event: { error: string }) => {\n            if (speechRecognition) {\n                speechRecognition.stop();\n                if (event.error == \"no-speech\") {\n                    alert(\"No speech was detected. Please check your system audio settings and try again.\");\n                } else if (event.error == \"language-not-supported\") {\n                    alert(\n                        `Speech recognition error detected: ${event.error}. The speech recognition input functionality does not yet work on all browsers, like Edge in Mac OS X with ARM chips. Try another browser/OS.`\n                    );\n                } else {\n                    alert(`Speech recognition error detected: ${event.error}.`);\n                }\n            }\n        };\n\n        setIsRecording(true);\n        speechRecognition.start();\n    };\n\n    const stopRecording = () => {\n        if (speechRecognition == null) {\n            console.error(\"SpeechRecognition not supported\");\n            return;\n        }\n        speechRecognition.stop();\n        setIsRecording(false);\n    };\n\n    if (speechRecognition == null) {\n        return <></>;\n    }\n    return (\n        <>\n            {!isRecording && (\n                <div className={styles.questionInputButtonsContainer}>\n                    <Tooltip content={t(\"tooltips.askWithVoice\")} relationship=\"label\">\n                        <Button size=\"large\" icon={<Mic28Filled primaryFill=\"rgba(115, 118, 225, 1)\" />} onClick={startRecording} />\n                    </Tooltip>\n                </div>\n            )}\n            {isRecording && (\n                <div className={styles.questionInputButtonsContainer}>\n                    <Tooltip content={t(\"tooltips.stopRecording\")} relationship=\"label\">\n                        <Button size=\"large\" icon={<Mic28Filled primaryFill=\"rgba(250, 0, 0, 0.7)\" />} disabled={!isRecording} onClick={stopRecording} />\n                    </Tooltip>\n                </div>\n            )}\n        </>\n    );\n};\n","/**\n * This file defines a context for managing login state in a React application.\n * Context provides a way to pass data through the component tree without having to pass props down manually at every level.\n * For more information, refer to the official React documentation:\n * https://react.dev/learn/passing-data-deeply-with-context\n */\n\nimport { createContext } from \"react\";\n\nexport const LoginContext = createContext({\n    loggedIn: false,\n    setLoggedIn: (_: boolean) => {}\n});\n","import { useState, useEffect, useContext } from \"react\";\nimport { Stack, TextField } from \"@fluentui/react\";\nimport { Button, Tooltip } from \"@fluentui/react-components\";\nimport { Send28Filled } from \"@fluentui/react-icons\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./QuestionInput.module.css\";\nimport { SpeechInput } from \"./SpeechInput\";\nimport { LoginContext } from \"../../loginContext\";\nimport { requireLogin } from \"../../authConfig\";\n\ninterface Props {\n    onSend: (question: string) => void;\n    disabled: boolean;\n    initQuestion?: string;\n    placeholder?: string;\n    clearOnSend?: boolean;\n    showSpeechInput?: boolean;\n}\n\nexport const QuestionInput = ({ onSend, disabled, placeholder, clearOnSend, initQuestion, showSpeechInput }: Props) => {\n    const [question, setQuestion] = useState<string>(\"\");\n    const { loggedIn } = useContext(LoginContext);\n    const { t } = useTranslation();\n    const [isComposing, setIsComposing] = useState(false);\n\n    useEffect(() => {\n        initQuestion && setQuestion(initQuestion);\n    }, [initQuestion]);\n\n    const sendQuestion = () => {\n        if (disabled || !question.trim()) {\n            return;\n        }\n\n        onSend(question);\n\n        if (clearOnSend) {\n            setQuestion(\"\");\n        }\n    };\n\n    const onEnterPress = (ev: React.KeyboardEvent<Element>) => {\n        if (isComposing) return;\n\n        if (ev.key === \"Enter\" && !ev.shiftKey) {\n            ev.preventDefault();\n            sendQuestion();\n        }\n    };\n\n    const handleCompositionStart = () => {\n        setIsComposing(true);\n    };\n    const handleCompositionEnd = () => {\n        setIsComposing(false);\n    };\n\n    const onQuestionChange = (_ev: React.FormEvent<HTMLInputElement | HTMLTextAreaElement>, newValue?: string) => {\n        if (!newValue) {\n            setQuestion(\"\");\n        } else if (newValue.length <= 1000) {\n            setQuestion(newValue);\n        }\n    };\n\n    const disableRequiredAccessControl = requireLogin && !loggedIn;\n    const sendQuestionDisabled = disabled || !question.trim() || disableRequiredAccessControl;\n\n    if (disableRequiredAccessControl) {\n        placeholder = \"Please login to continue...\";\n    }\n\n    return (\n        <Stack horizontal className={styles.questionInputContainer}>\n            <TextField\n                className={styles.questionInputTextArea}\n                disabled={disableRequiredAccessControl}\n                placeholder={placeholder}\n                multiline\n                resizable={false}\n                borderless\n                value={question}\n                onChange={onQuestionChange}\n                onKeyDown={onEnterPress}\n                onCompositionStart={handleCompositionStart}\n                onCompositionEnd={handleCompositionEnd}\n            />\n            <div className={styles.questionInputButtonsContainer}>\n                <Tooltip content={t(\"tooltips.submitQuestion\")} relationship=\"label\">\n                    <Button size=\"large\" icon={<Send28Filled primaryFill=\"rgba(115, 118, 225, 1)\" />} disabled={sendQuestionDisabled} onClick={sendQuestion} />\n                </Tooltip>\n            </div>\n            {showSpeechInput && <SpeechInput updateQuestion={setQuestion} />}\n        </Stack>\n    );\n};\n","import styles from \"./Example.module.css\";\n\ninterface Props {\n    text: string;\n    value: string;\n    onClick: (value: string) => void;\n}\n\nexport const Example = ({ text, value, onClick }: Props) => {\n    return (\n        <div className={styles.example} onClick={() => onClick(value)}>\n            <p className={styles.exampleText}>{text}</p>\n        </div>\n    );\n};\n","import { Example } from \"./Example\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./Example.module.css\";\n\ninterface Props {\n    onExampleClicked: (value: string) => void;\n    useGPT4V?: boolean;\n}\n\nexport const ExampleList = ({ onExampleClicked, useGPT4V }: Props) => {\n    const { t } = useTranslation();\n\n    const DEFAULT_EXAMPLES: string[] = [t(\"defaultExamples.1\"), t(\"defaultExamples.2\"), t(\"defaultExamples.3\")];\n    const GPT4V_EXAMPLES: string[] = [t(\"gpt4vExamples.1\"), t(\"gpt4vExamples.2\"), t(\"gpt4vExamples.3\")];\n\n    return (\n        <ul className={styles.examplesNavList}>\n            {(useGPT4V ? GPT4V_EXAMPLES : DEFAULT_EXAMPLES).map((question, i) => (\n                <li key={i}>\n                    <Example text={question} value={question} onClick={onExampleClicked} />\n                </li>\n            ))}\n        </ul>\n    );\n};\n","import styles from \"./UserChatMessage.module.css\";\n\ninterface Props {\n    message: string;\n}\n\nexport const UserChatMessage = ({ message }: Props) => {\n    return (\n        <div className={styles.container}>\n            <div className={styles.message}>{message}</div>\n        </div>\n    );\n};\n","import DOMPurify from \"dompurify\";\n\ntype ParsedSupportingContentItem = {\n    title: string;\n    content: string;\n};\n\nexport function parseSupportingContentItem(item: string): ParsedSupportingContentItem {\n    // Assumes the item starts with the file name followed by : and the content.\n    // Example: \"sdp_corporate.pdf: this is the content that follows\".\n    const parts = item.split(\": \");\n    const title = parts[0];\n    const content = DOMPurify.sanitize(parts.slice(1).join(\": \"));\n\n    return {\n        title,\n        content\n    };\n}\n","import { parseSupportingContentItem } from \"./SupportingContentParser\";\n\nimport styles from \"./SupportingContent.module.css\";\n\ninterface Props {\n    supportingContent: string[] | { text: string[]; images?: string[] };\n}\n\nexport const SupportingContent = ({ supportingContent }: Props) => {\n    const textItems = Array.isArray(supportingContent) ? supportingContent : supportingContent.text;\n    const imageItems = !Array.isArray(supportingContent) ? supportingContent?.images : [];\n    return (\n        <ul className={styles.supportingContentNavList}>\n            {textItems.map((c, ind) => {\n                const parsed = parseSupportingContentItem(c);\n                return (\n                    <li className={styles.supportingContentItem} key={`supporting-content-text-${ind}`}>\n                        <h4 className={styles.supportingContentItemHeader}>{parsed.title}</h4>\n                        <p className={styles.supportingContentItemText} dangerouslySetInnerHTML={{ __html: parsed.content }} />\n                    </li>\n                );\n            })}\n            {imageItems?.map((img, ind) => {\n                return (\n                    <li className={styles.supportingContentItem} key={`supporting-content-image-${ind}`}>\n                        <img className={styles.supportingContentItemImage} src={img} />\n                    </li>\n                );\n            })}\n        </ul>\n    );\n};\n","export enum AnalysisPanelTabs {\n    ThoughtProcessTab = \"thoughtProcess\",\n    SupportingContentTab = \"supportingContent\",\n    CitationTab = \"citation\"\n}\n","import React from \"react\";\nimport styles from \"./AnalysisPanel.module.css\";\n\nexport interface TokenUsage {\n    prompt_tokens: number;\n    completion_tokens: number;\n    reasoning_tokens: number;\n    total_tokens: number;\n}\n\ninterface TokenUsageGraphProps {\n    tokenUsage: TokenUsage;\n    reasoningEffort?: string;\n}\n\nexport const TokenUsageGraph: React.FC<TokenUsageGraphProps> = ({ tokenUsage, reasoningEffort }) => {\n    const { prompt_tokens, completion_tokens, reasoning_tokens, total_tokens } = tokenUsage;\n\n    // Calculate percentage widths relative to total_tokens\n    const calcPercent = (value: number) => (total_tokens ? (value / total_tokens) * 100 : 0) + \"%\";\n\n    return (\n        <div className={styles.tokenUsageGraph}>\n            <div className={styles.header}>Token Usage</div>\n            <div className={styles.primaryBarContainer} style={{ width: \"100%\" }}>\n                <div className={`${styles.tokenBar} ${styles.promptBar}`} style={{ width: calcPercent(prompt_tokens) }}>\n                    <span className={styles.tokenLabel}>Prompt: {prompt_tokens}</span>\n                </div>\n                {reasoningEffort != null && reasoningEffort !== \"\" && (\n                    <div className={`${styles.tokenBar} ${styles.reasoningBar}`} style={{ width: calcPercent(reasoning_tokens) }}>\n                        <span className={styles.tokenLabel}>Reasoning: {reasoning_tokens}</span>\n                    </div>\n                )}\n                <div className={`${styles.tokenBar} ${styles.outputBar}`} style={{ width: calcPercent(completion_tokens - reasoning_tokens) }}>\n                    <span className={styles.tokenLabel}>Output: {completion_tokens - reasoning_tokens}</span>\n                </div>\n            </div>\n\n            <div className={`${styles.tokenBar} ${styles.totalBar}`} style={{ width: calcPercent(total_tokens) }}>\n                <span className={styles.tokenLabel}>Total: {total_tokens}</span>\n            </div>\n        </div>\n    );\n};\n","import React from \"react\";\nimport { TokenUsageGraph, TokenUsage } from \"./TokenUsageGraph\";\nimport { Light as SyntaxHighlighter } from \"react-syntax-highlighter\";\nimport { a11yLight } from \"react-syntax-highlighter/dist/esm/styles/hljs\";\nimport json from \"react-syntax-highlighter/dist/esm/languages/hljs/json\";\nimport styles from \"./AnalysisPanel.module.css\";\nSyntaxHighlighter.registerLanguage(\"json\", json);\n\ntype ModelQueryPlanningStep = {\n    id: number;\n    type: \"ModelQueryPlanning\";\n    input_tokens: number;\n    output_tokens: number;\n};\n\ntype AzureSearchQueryStep = {\n    id: number;\n    type: \"AzureSearchQuery\";\n    target_index: string;\n    query: { search: string };\n    query_time: string;\n    count: number;\n    elapsed_ms: number;\n};\n\ntype Step = ModelQueryPlanningStep | AzureSearchQueryStep;\n\ninterface Props {\n    query_plan: Step[];\n    description: any;\n}\n\nexport const AgentPlan: React.FC<Props> = ({ query_plan, description }) => {\n    // find the planning step\n    const planning = query_plan.find((step): step is ModelQueryPlanningStep => step.type === \"ModelQueryPlanning\");\n\n    // collect all search query steps\n    const queries = query_plan.filter((step): step is AzureSearchQueryStep => step.type === \"AzureSearchQuery\");\n\n    return (\n        <div>\n            {planning && (\n                <TokenUsageGraph\n                    tokenUsage={\n                        {\n                            prompt_tokens: planning.input_tokens,\n                            completion_tokens: planning.output_tokens,\n                            reasoning_tokens: 0,\n                            total_tokens: planning.input_tokens + planning.output_tokens\n                        } as TokenUsage\n                    }\n                />\n            )}\n\n            <div className={styles.header}>Subqueries</div>\n            {queries.length > 0 && (\n                <table className={styles.subqueriesTable}>\n                    <thead>\n                        <tr>\n                            <th>Subquery</th>\n                            <th>Total Result Count</th>\n                            <th>Elapsed MS</th>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        {queries.map(q => (\n                            <tr key={q.id}>\n                                <td>{q.query.search}</td>\n                                <td>{q.count}</td>\n                                <td>{q.elapsed_ms}</td>\n                            </tr>\n                        ))}\n                    </tbody>\n                </table>\n            )}\n        </div>\n    );\n};\n","import { Stack } from \"@fluentui/react\";\nimport { Light as SyntaxHighlighter } from \"react-syntax-highlighter\";\nimport json from \"react-syntax-highlighter/dist/esm/languages/hljs/json\";\nimport { a11yLight } from \"react-syntax-highlighter/dist/esm/styles/hljs\";\n\nimport styles from \"./AnalysisPanel.module.css\";\n\nimport { Thoughts } from \"../../api\";\nimport { TokenUsageGraph } from \"./TokenUsageGraph\";\nimport { AgentPlan } from \"./AgentPlan\";\n\nSyntaxHighlighter.registerLanguage(\"json\", json);\n\ninterface Props {\n    thoughts: Thoughts[];\n}\n\nexport const ThoughtProcess = ({ thoughts }: Props) => {\n    return (\n        <ul className={styles.tList}>\n            {thoughts.map((t, ind) => {\n                return (\n                    <li className={styles.tListItem} key={ind}>\n                        <div className={styles.tStep}>{t.title}</div>\n                        <Stack horizontal tokens={{ childrenGap: 5 }}>\n                            {t.props &&\n                                (Object.keys(t.props).filter(k => k !== \"token_usage\" && k !== \"query_plan\") || []).map((k: any) => (\n                                    <span className={styles.tProp} key={k}>\n                                        {k}: {JSON.stringify(t.props?.[k])}\n                                    </span>\n                                ))}\n                        </Stack>\n                        {t.props?.token_usage && <TokenUsageGraph tokenUsage={t.props.token_usage} reasoningEffort={t.props.reasoning_effort} />}\n                        {t.props?.query_plan && <AgentPlan query_plan={t.props.query_plan} description={t.description} />}\n                        {Array.isArray(t.description) ? (\n                            <SyntaxHighlighter language=\"json\" wrapLongLines className={styles.tCodeBlock} style={a11yLight}>\n                                {JSON.stringify(t.description, null, 2)}\n                            </SyntaxHighlighter>\n                        ) : (\n                            <div>{t.description}</div>\n                        )}\n                    </li>\n                );\n            })}\n        </ul>\n    );\n};\n","import { Spinner, SpinnerSize, MessageBar, MessageBarType, Link, IconButton } from \"@fluentui/react\";\nimport { useTranslation } from \"react-i18next\";\nimport React, { useState, useEffect } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport remarkGfm from \"remark-gfm\";\n\nimport styles from \"./MarkdownViewer.module.css\";\n\ninterface MarkdownViewerProps {\n    src: string;\n}\n\nexport const MarkdownViewer: React.FC<MarkdownViewerProps> = ({ src }) => {\n    const [content, setContent] = useState<string>(\"\");\n    const [isLoading, setIsLoading] = useState<boolean>(true);\n    const [error, setError] = useState<Error | null>(null);\n    const { t } = useTranslation();\n\n    /**\n     * Anchor links result in HTTP 404 errors as the URL they point to does not exist.\n     * This function removes them from the markdown.\n     */\n    const removeAnchorLinks = (markdown: string) => {\n        const ancorLinksRegex = /\\[.*?\\]\\(#.*?\\)/g;\n        return markdown.replace(ancorLinksRegex, \"\");\n    };\n\n    useEffect(() => {\n        const fetchMarkdown = async () => {\n            try {\n                const response = await fetch(src);\n\n                if (!response.ok) {\n                    throw new Error(\"Failed loading markdown file.\");\n                }\n\n                let markdownText = await response.text();\n                markdownText = removeAnchorLinks(markdownText);\n                setContent(markdownText);\n            } catch (error: any) {\n                setError(error);\n            } finally {\n                setIsLoading(false);\n            }\n        };\n\n        fetchMarkdown();\n    }, [src]);\n\n    return (\n        <div>\n            {isLoading ? (\n                <div className={`${styles.loading} ${styles.markdownViewer}`}>\n                    <Spinner size={SpinnerSize.large} label=\"Loading file\" />\n                </div>\n            ) : error ? (\n                <div className={`${styles.error} ${styles.markdownViewer}`}>\n                    <MessageBar messageBarType={MessageBarType.error} isMultiline={false}>\n                        {error.message}\n                        <Link href={src} download>\n                            Download the file\n                        </Link>\n                    </MessageBar>\n                </div>\n            ) : (\n                <div>\n                    <IconButton\n                        className={styles.downloadButton}\n                        style={{ color: \"black\" }}\n                        iconProps={{ iconName: \"Save\" }}\n                        title={t(\"tooltips.save\")}\n                        ariaLabel={t(\"tooltips.save\")}\n                        href={src}\n                        download\n                    />\n                    <ReactMarkdown children={content} remarkPlugins={[remarkGfm]} className={`${styles.markdown} ${styles.markdownViewer}`} />\n                </div>\n            )}\n        </div>\n    );\n};\n","import { Stack, Pivot, PivotItem } from \"@fluentui/react\";\nimport { useTranslation } from \"react-i18next\";\nimport styles from \"./AnalysisPanel.module.css\";\n\nimport { SupportingContent } from \"../SupportingContent\";\nimport { ChatAppResponse } from \"../../api\";\nimport { AnalysisPanelTabs } from \"./AnalysisPanelTabs\";\nimport { ThoughtProcess } from \"./ThoughtProcess\";\nimport { MarkdownViewer } from \"../MarkdownViewer\";\nimport { useMsal } from \"@azure/msal-react\";\nimport { getHeaders } from \"../../api\";\nimport { useLogin, getToken } from \"../../authConfig\";\nimport { useState, useEffect } from \"react\";\n\ninterface Props {\n    className: string;\n    activeTab: AnalysisPanelTabs;\n    onActiveTabChanged: (tab: AnalysisPanelTabs) => void;\n    activeCitation: string | undefined;\n    citationHeight: string;\n    answer: ChatAppResponse;\n}\n\nconst pivotItemDisabledStyle = { disabled: true, style: { color: \"grey\" } };\n\nexport const AnalysisPanel = ({ answer, activeTab, activeCitation, citationHeight, className, onActiveTabChanged }: Props) => {\n    const isDisabledThoughtProcessTab: boolean = !answer.context.thoughts;\n    const isDisabledSupportingContentTab: boolean = !answer.context.data_points;\n    const isDisabledCitationTab: boolean = !activeCitation;\n    const [citation, setCitation] = useState(\"\");\n\n    const client = useLogin ? useMsal().instance : undefined;\n    const { t } = useTranslation();\n\n    const fetchCitation = async () => {\n        const token = client ? await getToken(client) : undefined;\n        if (activeCitation) {\n            // Get hash from the URL as it may contain #page=N\n            // which helps browser PDF renderer jump to correct page N\n            const originalHash = activeCitation.indexOf(\"#\") ? activeCitation.split(\"#\")[1] : \"\";\n            const response = await fetch(activeCitation, {\n                method: \"GET\",\n                headers: await getHeaders(token)\n            });\n            const citationContent = await response.blob();\n            let citationObjectUrl = URL.createObjectURL(citationContent);\n            // Add hash back to the new blob URL\n            if (originalHash) {\n                citationObjectUrl += \"#\" + originalHash;\n            }\n            setCitation(citationObjectUrl);\n        }\n    };\n    useEffect(() => {\n        fetchCitation();\n    }, []);\n\n    const renderFileViewer = () => {\n        if (!activeCitation) {\n            return null;\n        }\n\n        const fileExtension = activeCitation.split(\".\").pop()?.toLowerCase();\n        switch (fileExtension) {\n            case \"png\":\n                return <img src={citation} className={styles.citationImg} alt=\"Citation Image\" />;\n            case \"md\":\n                return <MarkdownViewer src={activeCitation} />;\n            default:\n                return <iframe title=\"Citation\" src={citation} width=\"100%\" height={citationHeight} />;\n        }\n    };\n\n    return (\n        <Pivot\n            className={className}\n            selectedKey={activeTab}\n            onLinkClick={pivotItem => pivotItem && onActiveTabChanged(pivotItem.props.itemKey! as AnalysisPanelTabs)}\n        >\n            <PivotItem\n                itemKey={AnalysisPanelTabs.ThoughtProcessTab}\n                headerText={t(\"headerTexts.thoughtProcess\")}\n                headerButtonProps={isDisabledThoughtProcessTab ? pivotItemDisabledStyle : undefined}\n            >\n                <ThoughtProcess thoughts={answer.context.thoughts || []} />\n            </PivotItem>\n            <PivotItem\n                itemKey={AnalysisPanelTabs.SupportingContentTab}\n                headerText={t(\"headerTexts.supportingContent\")}\n                headerButtonProps={isDisabledSupportingContentTab ? pivotItemDisabledStyle : undefined}\n            >\n                <SupportingContent supportingContent={answer.context.data_points} />\n            </PivotItem>\n            <PivotItem\n                itemKey={AnalysisPanelTabs.CitationTab}\n                headerText={t(\"headerTexts.citation\")}\n                headerButtonProps={isDisabledCitationTab ? pivotItemDisabledStyle : undefined}\n            >\n                {renderFileViewer()}\n            </PivotItem>\n        </Pivot>\n    );\n};\n","import { useState, useCallback } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport styles from \"./HistoryItem.module.css\";\nimport { DefaultButton } from \"@fluentui/react\";\nimport { Delete24Regular } from \"@fluentui/react-icons\";\n\nexport interface HistoryData {\n    id: string;\n    title: string;\n    timestamp: number;\n}\n\ninterface HistoryItemProps {\n    item: HistoryData;\n    onSelect: (id: string) => void;\n    onDelete: (id: string) => void;\n}\n\nexport function HistoryItem({ item, onSelect, onDelete }: HistoryItemProps) {\n    const [isModalOpen, setIsModalOpen] = useState(false);\n\n    const handleDelete = useCallback(() => {\n        setIsModalOpen(false);\n        onDelete(item.id);\n    }, [item.id, onDelete]);\n\n    return (\n        <div className={styles.historyItem}>\n            <button onClick={() => onSelect(item.id)} className={styles.historyItemButton}>\n                <div className={styles.historyItemTitle}>{item.title}</div>\n            </button>\n            <button onClick={() => setIsModalOpen(true)} className={styles.deleteButton} aria-label=\"delete this chat history\">\n                <Delete24Regular className={styles.deleteIcon} />\n            </button>\n            <DeleteHistoryModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} onConfirm={handleDelete} />\n        </div>\n    );\n}\n\nfunction DeleteHistoryModal({ isOpen, onClose, onConfirm }: { isOpen: boolean; onClose: () => void; onConfirm: () => void }) {\n    if (!isOpen) return null;\n    const { t } = useTranslation();\n    return (\n        <div className={styles.modalOverlay}>\n            <div className={styles.modalContent}>\n                <h2 className={styles.modalTitle}>{t(\"history.deleteModalTitle\")}</h2>\n                <p className={styles.modalDescription}>{t(\"history.deleteModalDescription\")}</p>\n                <div className={styles.modalActions}>\n                    <DefaultButton onClick={onClose} className={styles.modalCancelButton}>\n                        {t(\"history.cancelLabel\")}\n                    </DefaultButton>\n                    <DefaultButton onClick={onConfirm} className={styles.modalConfirmButton}>\n                        {t(\"history.deleteLabel\")}\n                    </DefaultButton>\n                </div>\n            </div>\n        </div>\n    );\n}\n","import { ChatAppResponse } from \"../../api\";\n\nexport type HistoryMetaData = { id: string; title: string; timestamp: number };\nexport type Answers = [user: string, response: ChatAppResponse][];\n\nexport const enum HistoryProviderOptions {\n    None = \"none\",\n    IndexedDB = \"indexedDB\",\n    CosmosDB = \"cosmosDB\"\n}\n\nexport interface IHistoryProvider {\n    getProviderName(): HistoryProviderOptions;\n    resetContinuationToken(): void;\n    getNextItems(count: number, idToken?: string): Promise<HistoryMetaData[]>;\n    addItem(id: string, answers: Answers, idToken?: string): Promise<void>;\n    getItem(id: string, idToken?: string): Promise<Answers | null>;\n    deleteItem(id: string, idToken?: string): Promise<void>;\n}\n","import { IHistoryProvider, Answers, HistoryProviderOptions, HistoryMetaData } from \"./IProvider\";\n\nexport class NoneProvider implements IHistoryProvider {\n    getProviderName = () => HistoryProviderOptions.None;\n    resetContinuationToken(): void {\n        return;\n    }\n    async getNextItems(count: number): Promise<HistoryMetaData[]> {\n        return [];\n    }\n    async addItem(id: string, answers: Answers): Promise<void> {\n        return;\n    }\n    async getItem(id: string): Promise<null> {\n        return null;\n    }\n    async deleteItem(id: string): Promise<void> {\n        return;\n    }\n}\n","import { IDBPDatabase, openDB } from \"idb\";\nimport { IHistoryProvider, Answers, HistoryProviderOptions, HistoryMetaData } from \"./IProvider\";\n\nexport class IndexedDBProvider implements IHistoryProvider {\n    getProviderName = () => HistoryProviderOptions.IndexedDB;\n\n    private dbName: string;\n    private storeName: string;\n    private dbPromise: Promise<IDBPDatabase> | null = null;\n    private cursorKey: IDBValidKey | undefined;\n    private isCusorEnd: boolean = false;\n\n    constructor(dbName: string, storeName: string) {\n        this.dbName = dbName;\n        this.storeName = storeName;\n        this.cursorKey = undefined;\n        this.isCusorEnd = false;\n    }\n\n    private async init() {\n        const storeName = this.storeName;\n        if (!this.dbPromise) {\n            this.dbPromise = openDB(this.dbName, 1, {\n                upgrade(db) {\n                    if (!db.objectStoreNames.contains(storeName)) {\n                        const store = db.createObjectStore(storeName, { keyPath: \"id\" });\n                        store.createIndex(\"timestamp\", \"timestamp\");\n                    }\n                }\n            });\n        }\n        return this.dbPromise;\n    }\n\n    resetContinuationToken() {\n        this.cursorKey = undefined;\n        this.isCusorEnd = false;\n    }\n\n    async getNextItems(count: number): Promise<HistoryMetaData[]> {\n        const db = await this.init();\n        const tx = db.transaction(this.storeName, \"readonly\");\n        const store = tx.objectStore(this.storeName);\n        const index = store.index(\"timestamp\");\n\n        // return empty array if cursor is already at the end\n        if (this.isCusorEnd) {\n            return [];\n        }\n\n        // set cursor to the last key\n        let cursor = this.cursorKey ? await index.openCursor(IDBKeyRange.upperBound(this.cursorKey), \"prev\") : await index.openCursor(null, \"prev\");\n\n        // return empty array means no more history or no data. set isCursorEnd to true and return empty array\n        if (!cursor) {\n            this.isCusorEnd = true;\n            return [];\n        }\n\n        const loadedItems: { id: string; title: string; timestamp: number; answers: Answers }[] = [];\n        for (let i = 0; i < count && cursor; i++) {\n            loadedItems.push(cursor.value);\n            cursor = await cursor.continue();\n        }\n\n        // set isCursorEnd to true if cursor is null\n        if (!cursor) {\n            this.isCusorEnd = true;\n        }\n\n        // update cursorKey\n        this.cursorKey = cursor?.key;\n\n        return loadedItems;\n    }\n\n    async addItem(id: string, answers: Answers): Promise<void> {\n        const timestamp = new Date().getTime();\n        const db = await this.init(); // 自動的に初期化\n        const tx = db.transaction(this.storeName, \"readwrite\");\n        const current = await tx.objectStore(this.storeName).get(id);\n        if (current) {\n            await tx.objectStore(this.storeName).put({ ...current, id, timestamp, answers });\n        } else {\n            const title = answers[0][0].length > 50 ? answers[0][0].substring(0, 50) + \"...\" : answers[0][0];\n            await tx.objectStore(this.storeName).add({ id, title, timestamp, answers });\n        }\n        await tx.done;\n        return;\n    }\n\n    async getItem(id: string): Promise<Answers | null> {\n        const db = await this.init();\n        const tx = db.transaction(this.storeName, \"readonly\");\n        const item = await tx.objectStore(this.storeName).get(id);\n        return item ? item.answers : null;\n    }\n\n    async deleteItem(id: string): Promise<void> {\n        const db = await this.init();\n        await db.delete(this.storeName, id);\n        return;\n    }\n}\n","import { IHistoryProvider, Answers, HistoryProviderOptions, HistoryMetaData } from \"./IProvider\";\nimport { deleteChatHistoryApi, getChatHistoryApi, getChatHistoryListApi, postChatHistoryApi } from \"../../api\";\n\nexport class CosmosDBProvider implements IHistoryProvider {\n    getProviderName = () => HistoryProviderOptions.CosmosDB;\n\n    private continuationToken: string | undefined;\n    private isItemEnd: boolean = false;\n\n    resetContinuationToken() {\n        this.continuationToken = undefined;\n        this.isItemEnd = false;\n    }\n\n    async getNextItems(count: number, idToken?: string): Promise<HistoryMetaData[]> {\n        if (this.isItemEnd) {\n            return [];\n        }\n\n        try {\n            const response = await getChatHistoryListApi(count, this.continuationToken, idToken || \"\");\n            this.continuationToken = response.continuation_token;\n            if (!this.continuationToken) {\n                this.isItemEnd = true;\n            }\n            return response.sessions.map(session => ({\n                id: session.id,\n                title: session.title,\n                timestamp: session.timestamp\n            }));\n        } catch (e) {\n            console.error(e);\n            return [];\n        }\n    }\n\n    async addItem(id: string, answers: Answers, idToken?: string): Promise<void> {\n        await postChatHistoryApi({ id, answers }, idToken || \"\");\n        return;\n    }\n\n    async getItem(id: string, idToken?: string): Promise<Answers | null> {\n        const response = await getChatHistoryApi(id, idToken || \"\");\n        return response.answers || null;\n    }\n\n    async deleteItem(id: string, idToken?: string): Promise<void> {\n        await deleteChatHistoryApi(id, idToken || \"\");\n        return;\n    }\n}\n","import { useMemo } from \"react\";\nimport { IHistoryProvider, HistoryProviderOptions } from \"../HistoryProviders/IProvider\";\nimport { NoneProvider } from \"../HistoryProviders/None\";\nimport { IndexedDBProvider } from \"../HistoryProviders/IndexedDB\";\nimport { CosmosDBProvider } from \"../HistoryProviders/CosmosDB\";\n\nexport const useHistoryManager = (provider: HistoryProviderOptions): IHistoryProvider => {\n    const providerInstance = useMemo(() => {\n        switch (provider) {\n            case HistoryProviderOptions.IndexedDB:\n                return new IndexedDBProvider(\"chat-database\", \"chat-history\");\n            case HistoryProviderOptions.CosmosDB:\n                return new CosmosDBProvider();\n            case HistoryProviderOptions.None:\n            default:\n                return new NoneProvider();\n        }\n    }, [provider]);\n\n    return providerInstance;\n};\n","import { useMsal } from \"@azure/msal-react\";\nimport { getToken, useLogin } from \"../../authConfig\";\nimport { Panel, PanelType, Spinner } from \"@fluentui/react\";\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport { HistoryData, HistoryItem } from \"../HistoryItem\";\nimport { Answers, HistoryProviderOptions } from \"../HistoryProviders/IProvider\";\nimport { useHistoryManager, HistoryMetaData } from \"../HistoryProviders\";\nimport { useTranslation } from \"react-i18next\";\nimport styles from \"./HistoryPanel.module.css\";\n\nconst HISTORY_COUNT_PER_LOAD = 20;\n\nexport const HistoryPanel = ({\n    provider,\n    isOpen,\n    notify,\n    onClose,\n    onChatSelected\n}: {\n    provider: HistoryProviderOptions;\n    isOpen: boolean;\n    notify: boolean;\n    onClose: () => void;\n    onChatSelected: (answers: Answers) => void;\n}) => {\n    const historyManager = useHistoryManager(provider);\n    const [history, setHistory] = useState<HistoryMetaData[]>([]);\n    const [isLoading, setIsLoading] = useState(false);\n    const [hasMoreHistory, setHasMoreHistory] = useState(false);\n\n    const client = useLogin ? useMsal().instance : undefined;\n\n    useEffect(() => {\n        if (!isOpen) return;\n        if (notify) {\n            setHistory([]);\n            historyManager.resetContinuationToken();\n            setHasMoreHistory(true);\n        }\n    }, [isOpen, notify]);\n\n    const loadMoreHistory = async () => {\n        setIsLoading(() => true);\n        const token = client ? await getToken(client) : undefined;\n        const items = await historyManager.getNextItems(HISTORY_COUNT_PER_LOAD, token);\n        if (items.length === 0) {\n            setHasMoreHistory(false);\n        }\n        setHistory(prevHistory => [...prevHistory, ...items]);\n        setIsLoading(() => false);\n    };\n\n    const handleSelect = async (id: string) => {\n        const token = client ? await getToken(client) : undefined;\n        const item = await historyManager.getItem(id, token);\n        if (item) {\n            onChatSelected(item);\n        }\n    };\n\n    const handleDelete = async (id: string) => {\n        const token = client ? await getToken(client) : undefined;\n        await historyManager.deleteItem(id, token);\n        setHistory(prevHistory => prevHistory.filter(item => item.id !== id));\n    };\n\n    const groupedHistory = useMemo(() => groupHistory(history), [history]);\n\n    const { t } = useTranslation();\n\n    return (\n        <Panel\n            type={PanelType.customNear}\n            style={{ padding: \"0px\" }}\n            headerText={t(\"history.chatHistory\")}\n            customWidth=\"300px\"\n            isBlocking={false}\n            isOpen={isOpen}\n            onDismiss={() => onClose()}\n            onDismissed={() => {\n                setHistory([]);\n                setHasMoreHistory(true);\n                historyManager.resetContinuationToken();\n            }}\n        >\n            <div>\n                {Object.entries(groupedHistory).map(([group, items]) => (\n                    <div key={group} className={styles.group}>\n                        <p className={styles.groupLabel}>{t(group)}</p>\n                        {items.map(item => (\n                            <HistoryItem key={item.id} item={item} onSelect={handleSelect} onDelete={handleDelete} />\n                        ))}\n                    </div>\n                ))}\n                {isLoading && <Spinner style={{ marginTop: \"10px\" }} />}\n                {history.length === 0 && !isLoading && <p>{t(\"history.noHistory\")}</p>}\n                {hasMoreHistory && !isLoading && <InfiniteLoadingButton func={loadMoreHistory} />}\n            </div>\n        </Panel>\n    );\n};\n\nfunction groupHistory(history: HistoryData[]) {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const yesterday = new Date(today);\n    yesterday.setDate(yesterday.getDate() - 1);\n    const lastWeek = new Date(today);\n    lastWeek.setDate(lastWeek.getDate() - 7);\n    const lastMonth = new Date(today);\n    lastMonth.setDate(lastMonth.getDate() - 30);\n\n    return history.reduce(\n        (groups, item) => {\n            const itemDate = new Date(item.timestamp);\n            let group;\n\n            if (itemDate >= today) {\n                group = \"history.today\";\n            } else if (itemDate >= yesterday) {\n                group = \"history.yesterday\";\n            } else if (itemDate >= lastWeek) {\n                group = \"history.last7days\";\n            } else if (itemDate >= lastMonth) {\n                group = \"history.last30days\";\n            } else {\n                group = itemDate.toLocaleDateString(undefined, { year: \"numeric\", month: \"long\" });\n            }\n\n            if (!groups[group]) {\n                groups[group] = [];\n            }\n            groups[group].push(item);\n            return groups;\n        },\n        {} as Record<string, HistoryData[]>\n    );\n}\n\nconst InfiniteLoadingButton = ({ func }: { func: () => void }) => {\n    const buttonRef = useRef(null);\n\n    useEffect(() => {\n        const observer = new IntersectionObserver(\n            entries => {\n                entries.forEach(entry => {\n                    if (entry.isIntersecting) {\n                        if (buttonRef.current) {\n                            func();\n                        }\n                    }\n                });\n            },\n            {\n                root: null,\n                threshold: 0\n            }\n        );\n\n        if (buttonRef.current) {\n            observer.observe(buttonRef.current);\n        }\n\n        return () => {\n            if (buttonRef.current) {\n                observer.unobserve(buttonRef.current);\n            }\n        };\n    }, []);\n\n    return <button ref={buttonRef} onClick={func} />;\n};\n","import { History24Regular } from \"@fluentui/react-icons\";\nimport { Button } from \"@fluentui/react-components\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./HistoryButton.module.css\";\n\ninterface Props {\n    className?: string;\n    onClick: () => void;\n    disabled?: boolean;\n}\n\nexport const HistoryButton = ({ className, disabled, onClick }: Props) => {\n    const { t } = useTranslation();\n    return (\n        <div className={`${styles.container} ${className ?? \"\"}`}>\n            <Button icon={<History24Regular />} disabled={disabled} onClick={onClick}>\n                {t(\"history.openChatHistory\")}\n            </Button>\n        </div>\n    );\n};\n","import { Settings24Regular } from \"@fluentui/react-icons\";\nimport { Button } from \"@fluentui/react-components\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./SettingsButton.module.css\";\n\ninterface Props {\n    className?: string;\n    onClick: () => void;\n}\n\nexport const SettingsButton = ({ className, onClick }: Props) => {\n    const { t } = useTranslation();\n    return (\n        <div className={`${styles.container} ${className ?? \"\"}`}>\n            <Button icon={<Settings24Regular />} onClick={onClick}>\n                {t(\"developerSettings\")}\n            </Button>\n        </div>\n    );\n};\n","import { Delete24Regular } from \"@fluentui/react-icons\";\nimport { Button } from \"@fluentui/react-components\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./ClearChatButton.module.css\";\n\ninterface Props {\n    className?: string;\n    onClick: () => void;\n    disabled?: boolean;\n}\n\nexport const ClearChatButton = ({ className, disabled, onClick }: Props) => {\n    const { t, i18n } = useTranslation();\n    return (\n        <div className={`${styles.container} ${className ?? \"\"}`}>\n            <Button icon={<Delete24Regular />} disabled={disabled} onClick={onClick}>\n                {t(\"clearChat\")}\n            </Button>\n        </div>\n    );\n};\n","import React, { useState, ChangeEvent } from \"react\";\nimport { Callout, Label, Text } from \"@fluentui/react\";\nimport { Button } from \"@fluentui/react-components\";\nimport { Add24Regular, Delete24Regular } from \"@fluentui/react-icons\";\nimport { useMsal } from \"@azure/msal-react\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { SimpleAPIResponse, uploadFileApi, deleteUploadedFileApi, listUploadedFilesApi } from \"../../api\";\nimport { useLogin, getToken } from \"../../authConfig\";\nimport styles from \"./UploadFile.module.css\";\n\ninterface Props {\n    className?: string;\n    disabled?: boolean;\n}\n\nexport const UploadFile: React.FC<Props> = ({ className, disabled }: Props) => {\n    // State variables to manage the component behavior\n    const [isCalloutVisible, setIsCalloutVisible] = useState<boolean>(false);\n    const [isUploading, setIsUploading] = useState<boolean>(false);\n    const [isLoading, setIsLoading] = useState<boolean>(true);\n    const [deletionStatus, setDeletionStatus] = useState<{ [filename: string]: \"pending\" | \"error\" | \"success\" }>({});\n    const [uploadedFile, setUploadedFile] = useState<SimpleAPIResponse>();\n    const [uploadedFileError, setUploadedFileError] = useState<string>();\n    const [uploadedFiles, setUploadedFiles] = useState<string[]>([]);\n    const { t } = useTranslation();\n\n    if (!useLogin) {\n        throw new Error(\"The UploadFile component requires useLogin to be true\");\n    }\n\n    const client = useMsal().instance;\n\n    // Handler for the \"Manage file uploads\" button\n    const handleButtonClick = async () => {\n        setIsCalloutVisible(!isCalloutVisible); // Toggle the Callout visibility\n\n        // Update uploaded files by calling the API\n        try {\n            const idToken = await getToken(client);\n            if (!idToken) {\n                throw new Error(\"No authentication token available\");\n            }\n            listUploadedFiles(idToken);\n        } catch (error) {\n            console.error(error);\n            setIsLoading(false);\n        }\n    };\n\n    const listUploadedFiles = async (idToken: string) => {\n        listUploadedFilesApi(idToken).then(files => {\n            setIsLoading(false);\n            setDeletionStatus({});\n            setUploadedFiles(files);\n        });\n    };\n\n    const handleRemoveFile = async (filename: string) => {\n        setDeletionStatus({ ...deletionStatus, [filename]: \"pending\" });\n\n        try {\n            const idToken = await getToken(client);\n            if (!idToken) {\n                throw new Error(\"No authentication token available\");\n            }\n\n            await deleteUploadedFileApi(filename, idToken);\n            setDeletionStatus({ ...deletionStatus, [filename]: \"success\" });\n            listUploadedFiles(idToken);\n        } catch (error) {\n            setDeletionStatus({ ...deletionStatus, [filename]: \"error\" });\n            console.error(error);\n        }\n    };\n\n    // Handler for the form submission (file upload)\n    const handleUploadFile = async (e: ChangeEvent<HTMLInputElement>) => {\n        e.preventDefault();\n        if (!e.target.files || e.target.files.length === 0) {\n            return;\n        }\n        setIsUploading(true); // Start the loading state\n        const file: File = e.target.files[0];\n        const formData = new FormData();\n        formData.append(\"file\", file);\n\n        try {\n            const idToken = await getToken(client);\n            if (!idToken) {\n                throw new Error(\"No authentication token available\");\n            }\n            const response: SimpleAPIResponse = await uploadFileApi(formData, idToken);\n            setUploadedFile(response);\n            setIsUploading(false);\n            setUploadedFileError(undefined);\n            listUploadedFiles(idToken);\n        } catch (error) {\n            console.error(error);\n            setIsUploading(false);\n            setUploadedFileError(t(\"upload.uploadedFileError\"));\n        }\n    };\n\n    return (\n        <div className={`${styles.container} ${className ?? \"\"}`}>\n            <div>\n                <Button id=\"calloutButton\" icon={<Add24Regular />} disabled={disabled} onClick={handleButtonClick}>\n                    {t(\"upload.manageFileUploads\")}\n                </Button>\n\n                {isCalloutVisible && (\n                    <Callout\n                        role=\"dialog\"\n                        gapSpace={0}\n                        className={styles.callout}\n                        target=\"#calloutButton\"\n                        onDismiss={() => setIsCalloutVisible(false)}\n                        setInitialFocus\n                    >\n                        <form encType=\"multipart/form-data\">\n                            <div>\n                                <Label>{t(\"upload.fileLabel\")}</Label>\n                                <input\n                                    accept=\".txt, .md, .json, .png, .jpg, .jpeg, .bmp, .heic, .tiff, .pdf, .docx, .xlsx, .pptx, .html\"\n                                    className={styles.chooseFiles}\n                                    type=\"file\"\n                                    onChange={handleUploadFile}\n                                />\n                            </div>\n                        </form>\n\n                        {/* Show a loading message while files are being uploaded */}\n                        {isUploading && <Text>{t(\"upload.uploadingFiles\")}</Text>}\n                        {!isUploading && uploadedFileError && <Text>{uploadedFileError}</Text>}\n                        {!isUploading && uploadedFile && <Text>{uploadedFile.message}</Text>}\n\n                        {/* Display the list of already uploaded */}\n                        <h3>{t(\"upload.uploadedFilesLabel\")}</h3>\n\n                        {isLoading && <Text>{t(\"upload.loading\")}</Text>}\n                        {!isLoading && uploadedFiles.length === 0 && <Text>{t(\"upload.noFilesUploaded\")}</Text>}\n                        {uploadedFiles.map((filename, index) => {\n                            return (\n                                <div key={index} className={styles.list}>\n                                    <div className={styles.item}>{filename}</div>\n                                    {/* Button to remove a file from the list */}\n                                    <Button\n                                        icon={<Delete24Regular />}\n                                        onClick={() => handleRemoveFile(filename)}\n                                        disabled={deletionStatus[filename] === \"pending\" || deletionStatus[filename] === \"success\"}\n                                    >\n                                        {!deletionStatus[filename] && t(\"upload.deleteFile\")}\n                                        {deletionStatus[filename] == \"pending\" && t(\"upload.deletingFile\")}\n                                        {deletionStatus[filename] == \"error\" && t(\"upload.errorDeleting\")}\n                                        {deletionStatus[filename] == \"success\" && t(\"upload.fileDeleted\")}\n                                    </Button>\n                                </div>\n                            );\n                        })}\n                    </Callout>\n                )}\n            </div>\n        </div>\n    );\n};\n","import { Label } from \"@fluentui/react\";\nimport { useMsal } from \"@azure/msal-react\";\nimport {\n    DataGridBody,\n    DataGridRow,\n    DataGrid,\n    DataGridHeader,\n    DataGridHeaderCell,\n    DataGridCell,\n    createTableColumn,\n    TableColumnDefinition\n} from \"@fluentui/react-table\";\nimport { getTokenClaims } from \"../../authConfig\";\nimport { useState, useEffect } from \"react\";\n\ntype Claim = {\n    name: string;\n    value: string;\n};\n\nexport const TokenClaimsDisplay = () => {\n    const { instance } = useMsal();\n    const activeAccount = instance.getActiveAccount();\n    const [claims, setClaims] = useState<Record<string, unknown> | undefined>(undefined);\n\n    useEffect(() => {\n        const fetchClaims = async () => {\n            setClaims(await getTokenClaims(instance));\n        };\n\n        fetchClaims();\n    }, []);\n\n    const ToString = (a: string | any) => {\n        if (typeof a === \"string\") {\n            return a;\n        } else {\n            return JSON.stringify(a);\n        }\n    };\n\n    let createClaims = (o: Record<string, unknown> | undefined) => {\n        return Object.keys(o ?? {}).map((key: string) => {\n            let originalKey = key;\n            try {\n                // Some claim names may be a URL to a full schema, just use the last part of the URL in this case\n                const url = new URL(key);\n                const parts = url.pathname.split(\"/\");\n                key = parts[parts.length - 1];\n            } catch (error) {\n                // Do not parse key if it's not a URL\n            }\n            return { name: key, value: ToString((o ?? {})[originalKey]) };\n        });\n    };\n    const items: Claim[] = createClaims(claims);\n\n    const columns: TableColumnDefinition<Claim>[] = [\n        createTableColumn<Claim>({\n            columnId: \"name\",\n            compare: (a: Claim, b: Claim) => {\n                return a.name.localeCompare(b.name);\n            },\n            renderHeaderCell: () => {\n                return \"Name\";\n            },\n            renderCell: item => {\n                return item.name;\n            }\n        }),\n        createTableColumn<Claim>({\n            columnId: \"value\",\n            compare: (a: Claim, b: Claim) => {\n                return a.value.localeCompare(b.value);\n            },\n            renderHeaderCell: () => {\n                return \"Value\";\n            },\n            renderCell: item => {\n                return item.value;\n            }\n        })\n    ];\n\n    return (\n        <div>\n            <Label>ID Token Claims</Label>\n            <DataGrid items={items} columns={columns} sortable getRowId={item => item.name}>\n                <DataGridHeader>\n                    <DataGridRow>{({ renderHeaderCell }) => <DataGridHeaderCell>{renderHeaderCell()}</DataGridHeaderCell>}</DataGridRow>\n                </DataGridHeader>\n                <DataGridBody<Claim>>\n                    {({ item, rowId }) => <DataGridRow<Claim> key={rowId}>{({ renderCell }) => <DataGridCell>{renderCell(item)}</DataGridCell>}</DataGridRow>}\n                </DataGridBody>\n            </DataGrid>\n        </div>\n    );\n};\n","import { useTranslation } from \"react-i18next\";\nimport { LocalLanguage24Regular } from \"@fluentui/react-icons\";\nimport { IDropdownOption, Dropdown } from \"@fluentui/react\";\nimport { useId } from \"@fluentui/react-hooks\";\n\nimport { supportedLngs } from \"./config\";\nimport styles from \"./LanguagePicker.module.css\";\n\ninterface Props {\n    onLanguageChange: (language: string) => void;\n}\n\nexport const LanguagePicker = ({ onLanguageChange }: Props) => {\n    const { i18n } = useTranslation();\n\n    const handleLanguageChange = (_ev: React.FormEvent<HTMLDivElement>, option?: IDropdownOption<string> | undefined) => {\n        onLanguageChange(option?.data || i18n.language);\n    };\n    const languagePickerId = useId(\"languagePicker\");\n    const { t } = useTranslation();\n\n    return (\n        <div className={styles.languagePicker}>\n            <LocalLanguage24Regular className={styles.languagePickerIcon} />\n            <Dropdown\n                id={languagePickerId}\n                selectedKey={i18n.language}\n                options={Object.entries(supportedLngs).map(([code, details]) => ({\n                    key: code,\n                    text: details.name,\n                    selected: code === i18n.language,\n                    data: code\n                }))}\n                onChange={handleLanguageChange}\n                ariaLabel={t(\"labels.languagePicker\")}\n            />\n        </div>\n    );\n};\n","import { ITextFieldProps, DefaultButton, IconButton, IButtonStyles, Callout, IStackTokens, Stack, IStackStyles, initializeIcons } from \"@fluentui/react\";\nimport { useBoolean, useId } from \"@fluentui/react-hooks\";\nimport { useTranslation } from \"react-i18next\";\n\nconst stackTokens: IStackTokens = {\n    childrenGap: 4,\n    maxWidth: 300\n};\n\nconst labelCalloutStackStyles: Partial<IStackStyles> = { root: { padding: 20 } };\nconst iconButtonStyles: Partial<IButtonStyles> = { root: { marginBottom: -3 } };\nconst iconProps = { iconName: \"Info\" };\n\ninterface IHelpCalloutProps {\n    label: string | undefined;\n    labelId: string;\n    fieldId: string | undefined;\n    helpText: string;\n}\n\nexport const HelpCallout = (props: IHelpCalloutProps): JSX.Element => {\n    const [isCalloutVisible, { toggle: toggleIsCalloutVisible }] = useBoolean(false);\n    const descriptionId: string = useId(\"description\");\n    const iconButtonId: string = useId(\"iconButton\");\n    const { t } = useTranslation();\n\n    return (\n        <>\n            <Stack horizontal verticalAlign=\"center\" tokens={stackTokens}>\n                <label id={props.labelId} htmlFor={props.fieldId}>\n                    {props.label}\n                </label>\n                <IconButton\n                    id={iconButtonId}\n                    iconProps={iconProps}\n                    title={t(\"tooltips.info\")}\n                    ariaLabel={t(\"tooltips.info\")}\n                    onClick={toggleIsCalloutVisible}\n                    styles={iconButtonStyles}\n                />\n            </Stack>\n            {isCalloutVisible && (\n                <Callout target={\"#\" + iconButtonId} setInitialFocus onDismiss={toggleIsCalloutVisible} ariaDescribedBy={descriptionId} role=\"alertdialog\">\n                    <Stack tokens={stackTokens} horizontalAlign=\"start\" styles={labelCalloutStackStyles}>\n                        <span id={descriptionId}>{props.helpText}</span>\n                        <DefaultButton onClick={toggleIsCalloutVisible}>{t(\"labels.closeButton\")}</DefaultButton>\n                    </Stack>\n                </Callout>\n            )}\n        </>\n    );\n};\n","import { useEffect, useState } from \"react\";\nimport { Stack, Checkbox, ICheckboxProps, IDropdownOption, IDropdownProps, Dropdown } from \"@fluentui/react\";\nimport { useId } from \"@fluentui/react-hooks\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./GPT4VSettings.module.css\";\nimport { GPT4VInput } from \"../../api\";\nimport { HelpCallout } from \"../../components/HelpCallout\";\n\ninterface Props {\n    gpt4vInputs: GPT4VInput;\n    isUseGPT4V: boolean;\n    updateGPT4VInputs: (input: GPT4VInput) => void;\n    updateUseGPT4V: (useGPT4V: boolean) => void;\n}\n\nexport const GPT4VSettings = ({ updateGPT4VInputs, updateUseGPT4V, isUseGPT4V, gpt4vInputs }: Props) => {\n    const [useGPT4V, setUseGPT4V] = useState<boolean>(isUseGPT4V);\n    const [vectorFieldOption, setVectorFieldOption] = useState<GPT4VInput>(gpt4vInputs || GPT4VInput.TextAndImages);\n\n    const onuseGPT4V = (_ev?: React.FormEvent<HTMLElement | HTMLInputElement>, checked?: boolean) => {\n        updateUseGPT4V(!!checked);\n        setUseGPT4V(!!checked);\n    };\n\n    const onSetGPT4VInput = (_ev: React.FormEvent<HTMLDivElement>, option?: IDropdownOption<GPT4VInput> | undefined) => {\n        if (option) {\n            const data = option.key as GPT4VInput;\n            updateGPT4VInputs(data || GPT4VInput.TextAndImages);\n            data && setVectorFieldOption(data);\n        }\n    };\n\n    useEffect(() => {\n        useGPT4V && updateGPT4VInputs(GPT4VInput.TextAndImages);\n    }, [useGPT4V]);\n\n    const useGPT4VId = useId(\"useGPT4V\");\n    const useGPT4VFieldId = useId(\"useGPT4VField\");\n    const gpt4VInputId = useId(\"gpt4VInput\");\n    const gpt4VInputFieldId = useId(\"gpt4VInputField\");\n    const { t } = useTranslation();\n\n    return (\n        <Stack className={styles.container} tokens={{ childrenGap: 10 }}>\n            <Checkbox\n                id={useGPT4VFieldId}\n                checked={useGPT4V}\n                label={t(\"labels.useGPT4V\")}\n                onChange={onuseGPT4V}\n                aria-labelledby={useGPT4VId}\n                onRenderLabel={(props: ICheckboxProps | undefined) => (\n                    <HelpCallout labelId={useGPT4VId} fieldId={useGPT4VFieldId} helpText={t(\"helpTexts.useGPT4Vision\")} label={props?.label} />\n                )}\n            />\n            {useGPT4V && (\n                <Dropdown\n                    id={gpt4VInputFieldId}\n                    selectedKey={vectorFieldOption}\n                    label={t(\"labels.gpt4VInput.label\")}\n                    options={[\n                        {\n                            key: GPT4VInput.TextAndImages,\n                            text: t(\"labels.gpt4VInput.options.textAndImages\")\n                        },\n                        { text: t(\"labels.gpt4VInput.options.images\"), key: GPT4VInput.Images },\n                        { text: t(\"labels.gpt4VInput.options.texts\"), key: GPT4VInput.Texts }\n                    ]}\n                    required\n                    onChange={onSetGPT4VInput}\n                    aria-labelledby={gpt4VInputId}\n                    onRenderLabel={(props: IDropdownProps | undefined) => (\n                        <HelpCallout labelId={gpt4VInputId} fieldId={gpt4VInputFieldId} helpText={t(\"helpTexts.gpt4VisionInputs\")} label={props?.label} />\n                    )}\n                />\n            )}\n        </Stack>\n    );\n};\n","import { useEffect, useState } from \"react\";\nimport { Stack, IDropdownOption, Dropdown, IDropdownProps } from \"@fluentui/react\";\nimport { useId } from \"@fluentui/react-hooks\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./VectorSettings.module.css\";\nimport { HelpCallout } from \"../../components/HelpCallout\";\nimport { RetrievalMode, VectorFields } from \"../../api\";\n\ninterface Props {\n    showImageOptions?: boolean;\n    defaultRetrievalMode: RetrievalMode;\n    defaultVectorFields?: VectorFields;\n    updateRetrievalMode: (retrievalMode: RetrievalMode) => void;\n    updateVectorFields: (vectorFields: VectorFields) => void;\n}\n\nexport const VectorSettings = ({ updateRetrievalMode, updateVectorFields, showImageOptions, defaultRetrievalMode, defaultVectorFields }: Props) => {\n    const [retrievalMode, setRetrievalMode] = useState<RetrievalMode>(defaultRetrievalMode || RetrievalMode.Hybrid);\n    const [vectorFields, setVectorFields] = useState<VectorFields>(defaultVectorFields || VectorFields.TextAndImageEmbeddings);\n\n    const onRetrievalModeChange = (_ev: React.FormEvent<HTMLDivElement>, option?: IDropdownOption<RetrievalMode> | undefined) => {\n        setRetrievalMode(option?.data || RetrievalMode.Hybrid);\n        updateRetrievalMode(option?.data || RetrievalMode.Hybrid);\n    };\n\n    const onVectorFieldsChange = (_ev: React.FormEvent<HTMLDivElement>, option?: IDropdownOption<VectorFields> | undefined) => {\n        setVectorFields(option?.data || VectorFields.TextAndImageEmbeddings);\n        updateVectorFields(option?.data || VectorFields.TextAndImageEmbeddings);\n    };\n\n    // Only run if showImageOptions changes from true to false or false to true\n    useEffect(() => {\n        if (!showImageOptions) {\n            // If images are disabled, we must force to text-only embeddings\n            setVectorFields(VectorFields.Embedding);\n            updateVectorFields(VectorFields.Embedding);\n        } else {\n            // When image options become available, reset to default or use TextAndImageEmbeddings\n            setVectorFields(defaultVectorFields || VectorFields.TextAndImageEmbeddings);\n            updateVectorFields(defaultVectorFields || VectorFields.TextAndImageEmbeddings);\n        }\n    }, [showImageOptions, updateVectorFields, defaultVectorFields]);\n\n    const retrievalModeId = useId(\"retrievalMode\");\n    const retrievalModeFieldId = useId(\"retrievalModeField\");\n    const vectorFieldsId = useId(\"vectorFields\");\n    const vectorFieldsFieldId = useId(\"vectorFieldsField\");\n    const { t } = useTranslation();\n\n    return (\n        <Stack className={styles.container} tokens={{ childrenGap: 10 }}>\n            <Dropdown\n                id={retrievalModeFieldId}\n                label={t(\"labels.retrievalMode.label\")}\n                selectedKey={retrievalMode.toString()}\n                options={[\n                    {\n                        key: \"hybrid\",\n                        text: t(\"labels.retrievalMode.options.hybrid\"),\n                        selected: retrievalMode == RetrievalMode.Hybrid,\n                        data: RetrievalMode.Hybrid\n                    },\n                    {\n                        key: \"vectors\",\n                        text: t(\"labels.retrievalMode.options.vectors\"),\n                        selected: retrievalMode == RetrievalMode.Vectors,\n                        data: RetrievalMode.Vectors\n                    },\n                    { key: \"text\", text: t(\"labels.retrievalMode.options.texts\"), selected: retrievalMode == RetrievalMode.Text, data: RetrievalMode.Text }\n                ]}\n                required\n                onChange={onRetrievalModeChange}\n                aria-labelledby={retrievalModeId}\n                onRenderLabel={(props: IDropdownProps | undefined) => (\n                    <HelpCallout labelId={retrievalModeId} fieldId={retrievalModeFieldId} helpText={t(\"helpTexts.retrievalMode\")} label={props?.label} />\n                )}\n            />\n\n            {showImageOptions && [RetrievalMode.Vectors, RetrievalMode.Hybrid].includes(retrievalMode) && (\n                <Dropdown\n                    id={vectorFieldsFieldId}\n                    label={t(\"labels.vector.label\")}\n                    selectedKey={vectorFields}\n                    options={[\n                        {\n                            key: VectorFields.Embedding,\n                            text: t(\"labels.vector.options.embedding\"),\n                            selected: vectorFields === VectorFields.Embedding,\n                            data: VectorFields.Embedding\n                        },\n                        {\n                            key: VectorFields.ImageEmbedding,\n                            text: t(\"labels.vector.options.imageEmbedding\"),\n                            selected: vectorFields === VectorFields.ImageEmbedding,\n                            data: VectorFields.ImageEmbedding\n                        },\n                        {\n                            key: VectorFields.TextAndImageEmbeddings,\n                            text: t(\"labels.vector.options.both\"),\n                            selected: vectorFields === VectorFields.TextAndImageEmbeddings,\n                            data: VectorFields.TextAndImageEmbeddings\n                        }\n                    ]}\n                    onChange={onVectorFieldsChange}\n                    aria-labelledby={vectorFieldsId}\n                    onRenderLabel={(props: IDropdownProps | undefined) => (\n                        <HelpCallout labelId={vectorFieldsId} fieldId={vectorFieldsFieldId} helpText={t(\"helpTexts.vectorFields\")} label={props?.label} />\n                    )}\n                />\n            )}\n        </Stack>\n    );\n};\n","import { useId } from \"@fluentui/react-hooks\";\nimport { useTranslation } from \"react-i18next\";\nimport { TextField, ITextFieldProps, Checkbox, ICheckboxProps, Dropdown, IDropdownProps, IDropdownOption } from \"@fluentui/react\";\nimport { HelpCallout } from \"../HelpCallout\";\nimport { GPT4VSettings } from \"../GPT4VSettings\";\nimport { VectorSettings } from \"../VectorSettings\";\nimport { RetrievalMode, VectorFields, GPT4VInput } from \"../../api\";\nimport styles from \"./Settings.module.css\";\n\n// Add type for onRenderLabel\ntype RenderLabelType = ITextFieldProps | IDropdownProps | ICheckboxProps;\n\nexport interface SettingsProps {\n    promptTemplate: string;\n    temperature: number;\n    retrieveCount: number;\n    maxSubqueryCount: number;\n    resultsMergeStrategy: string;\n    seed: number | null;\n    minimumSearchScore: number;\n    minimumRerankerScore: number;\n    useSemanticRanker: boolean;\n    useSemanticCaptions: boolean;\n    useQueryRewriting: boolean;\n    reasoningEffort: string;\n    excludeCategory: string;\n    includeCategory: string;\n    retrievalMode: RetrievalMode;\n    useGPT4V: boolean;\n    gpt4vInput: GPT4VInput;\n    vectorFields: VectorFields;\n    showSemanticRankerOption: boolean;\n    showQueryRewritingOption: boolean;\n    showReasoningEffortOption: boolean;\n    showGPT4VOptions: boolean;\n    showVectorOption: boolean;\n    useOidSecurityFilter: boolean;\n    useGroupsSecurityFilter: boolean;\n    useLogin: boolean;\n    loggedIn: boolean;\n    requireAccessControl: boolean;\n    className?: string;\n    onChange: (field: string, value: any) => void;\n    streamingEnabled?: boolean; // Only used in chat\n    shouldStream?: boolean; // Only used in Chat\n    useSuggestFollowupQuestions?: boolean; // Only used in Chat\n    promptTemplatePrefix?: string;\n    promptTemplateSuffix?: string;\n    showSuggestFollowupQuestions?: boolean;\n    showAgenticRetrievalOption: boolean;\n    useAgenticRetrieval: boolean;\n}\n\nexport const Settings = ({\n    promptTemplate,\n    temperature,\n    retrieveCount,\n    maxSubqueryCount,\n    resultsMergeStrategy,\n    seed,\n    minimumSearchScore,\n    minimumRerankerScore,\n    useSemanticRanker,\n    useSemanticCaptions,\n    useQueryRewriting,\n    reasoningEffort,\n    excludeCategory,\n    includeCategory,\n    retrievalMode,\n    useGPT4V,\n    gpt4vInput,\n    vectorFields,\n    showSemanticRankerOption,\n    showQueryRewritingOption,\n    showReasoningEffortOption,\n    showGPT4VOptions,\n    showVectorOption,\n    useOidSecurityFilter,\n    useGroupsSecurityFilter,\n    useLogin,\n    loggedIn,\n    requireAccessControl,\n    className,\n    onChange,\n    streamingEnabled,\n    shouldStream,\n    useSuggestFollowupQuestions,\n    promptTemplatePrefix,\n    promptTemplateSuffix,\n    showSuggestFollowupQuestions,\n    showAgenticRetrievalOption,\n    useAgenticRetrieval\n}: SettingsProps) => {\n    const { t } = useTranslation();\n\n    // Form field IDs\n    const promptTemplateId = useId(\"promptTemplate\");\n    const promptTemplateFieldId = useId(\"promptTemplateField\");\n    const temperatureId = useId(\"temperature\");\n    const temperatureFieldId = useId(\"temperatureField\");\n    const seedId = useId(\"seed\");\n    const seedFieldId = useId(\"seedField\");\n    const agenticRetrievalId = useId(\"agenticRetrieval\");\n    const agenticRetrievalFieldId = useId(\"agenticRetrievalField\");\n    const searchScoreId = useId(\"searchScore\");\n    const searchScoreFieldId = useId(\"searchScoreField\");\n    const rerankerScoreId = useId(\"rerankerScore\");\n    const rerankerScoreFieldId = useId(\"rerankerScoreField\");\n    const retrieveCountId = useId(\"retrieveCount\");\n    const retrieveCountFieldId = useId(\"retrieveCountField\");\n    const maxSubqueryCountId = useId(\"maxSubqueryCount\");\n    const maxSubqueryCountFieldId = useId(\"maxSubqueryCountField\");\n    const resultsMergeStrategyFieldId = useId(\"resultsMergeStrategy\");\n    const includeCategoryId = useId(\"includeCategory\");\n    const includeCategoryFieldId = useId(\"includeCategoryField\");\n    const excludeCategoryId = useId(\"excludeCategory\");\n    const excludeCategoryFieldId = useId(\"excludeCategoryField\");\n    const semanticRankerId = useId(\"semanticRanker\");\n    const semanticRankerFieldId = useId(\"semanticRankerField\");\n    const queryRewritingFieldId = useId(\"queryRewritingField\");\n    const reasoningEffortFieldId = useId(\"reasoningEffortField\");\n    const semanticCaptionsId = useId(\"semanticCaptions\");\n    const semanticCaptionsFieldId = useId(\"semanticCaptionsField\");\n    const useOidSecurityFilterId = useId(\"useOidSecurityFilter\");\n    const useOidSecurityFilterFieldId = useId(\"useOidSecurityFilterField\");\n    const useGroupsSecurityFilterId = useId(\"useGroupsSecurityFilter\");\n    const useGroupsSecurityFilterFieldId = useId(\"useGroupsSecurityFilterField\");\n    const shouldStreamId = useId(\"shouldStream\");\n    const shouldStreamFieldId = useId(\"shouldStreamField\");\n    const suggestFollowupQuestionsId = useId(\"suggestFollowupQuestions\");\n    const suggestFollowupQuestionsFieldId = useId(\"suggestFollowupQuestionsField\");\n\n    const renderLabel = (props: RenderLabelType | undefined, labelId: string, fieldId: string, helpText: string) => (\n        <HelpCallout labelId={labelId} fieldId={fieldId} helpText={helpText} label={props?.label} />\n    );\n\n    return (\n        <div className={className}>\n            <TextField\n                id={promptTemplateFieldId}\n                className={styles.settingsSeparator}\n                defaultValue={promptTemplate}\n                label={t(\"labels.promptTemplate\")}\n                multiline\n                autoAdjustHeight\n                onChange={(_ev, val) => onChange(\"promptTemplate\", val || \"\")}\n                aria-labelledby={promptTemplateId}\n                onRenderLabel={props => renderLabel(props, promptTemplateId, promptTemplateFieldId, t(\"helpTexts.promptTemplate\"))}\n            />\n\n            <TextField\n                id={temperatureFieldId}\n                className={styles.settingsSeparator}\n                label={t(\"labels.temperature\")}\n                type=\"number\"\n                min={0}\n                max={1}\n                step={0.1}\n                defaultValue={temperature.toString()}\n                onChange={(_ev, val) => onChange(\"temperature\", parseFloat(val || \"0\"))}\n                aria-labelledby={temperatureId}\n                onRenderLabel={props => renderLabel(props, temperatureId, temperatureFieldId, t(\"helpTexts.temperature\"))}\n            />\n\n            <TextField\n                id={seedFieldId}\n                className={styles.settingsSeparator}\n                label={t(\"labels.seed\")}\n                type=\"text\"\n                defaultValue={seed?.toString() || \"\"}\n                onChange={(_ev, val) => onChange(\"seed\", val ? parseInt(val) : null)}\n                aria-labelledby={seedId}\n                onRenderLabel={props => renderLabel(props, seedId, seedFieldId, t(\"helpTexts.seed\"))}\n            />\n\n            {showAgenticRetrievalOption && (\n                <Checkbox\n                    id={agenticRetrievalFieldId}\n                    className={styles.settingsSeparator}\n                    checked={useAgenticRetrieval}\n                    label={t(\"labels.useAgenticRetrieval\")}\n                    onChange={(_ev, checked) => onChange(\"useAgenticRetrieval\", !!checked)}\n                    aria-labelledby={agenticRetrievalId}\n                    onRenderLabel={props => renderLabel(props, agenticRetrievalId, agenticRetrievalFieldId, t(\"helpTexts.suggestFollowupQuestions\"))}\n                />\n            )}\n            {!useAgenticRetrieval && !useGPT4V && (\n                <TextField\n                    id={searchScoreFieldId}\n                    className={styles.settingsSeparator}\n                    label={t(\"labels.minimumSearchScore\")}\n                    type=\"number\"\n                    min={0}\n                    step={0.01}\n                    defaultValue={minimumSearchScore.toString()}\n                    onChange={(_ev, val) => onChange(\"minimumSearchScore\", parseFloat(val || \"0\"))}\n                    aria-labelledby={searchScoreId}\n                    onRenderLabel={props => renderLabel(props, searchScoreId, searchScoreFieldId, t(\"helpTexts.searchScore\"))}\n                />\n            )}\n\n            {showSemanticRankerOption && (\n                <TextField\n                    id={rerankerScoreFieldId}\n                    className={styles.settingsSeparator}\n                    label={t(\"labels.minimumRerankerScore\")}\n                    type=\"number\"\n                    min={1}\n                    max={4}\n                    step={0.1}\n                    defaultValue={minimumRerankerScore.toString()}\n                    onChange={(_ev, val) => onChange(\"minimumRerankerScore\", parseFloat(val || \"0\"))}\n                    aria-labelledby={rerankerScoreId}\n                    onRenderLabel={props => renderLabel(props, rerankerScoreId, rerankerScoreFieldId, t(\"helpTexts.rerankerScore\"))}\n                />\n            )}\n\n            {showAgenticRetrievalOption && useAgenticRetrieval && (\n                <TextField\n                    id={maxSubqueryCountFieldId}\n                    className={styles.settingsSeparator}\n                    label={t(\"labels.maxSubqueryCount\")}\n                    type=\"number\"\n                    min={2}\n                    max={40}\n                    defaultValue={maxSubqueryCount.toString()}\n                    onChange={(_ev, val) => onChange(\"maxSubqueryCount\", parseInt(val || \"10\"))}\n                    aria-labelledby={maxSubqueryCountId}\n                    onRenderLabel={props => renderLabel(props, maxSubqueryCountId, maxSubqueryCountFieldId, t(\"helpTexts.maxSubqueryCount\"))}\n                />\n            )}\n\n            {showAgenticRetrievalOption && useAgenticRetrieval && (\n                <Dropdown\n                    id={resultsMergeStrategyFieldId}\n                    className={styles.settingsSeparator}\n                    label={t(\"labels.resultsMergeStrategy\")}\n                    selectedKey={resultsMergeStrategy}\n                    onChange={(_ev?: React.FormEvent<HTMLElement | HTMLInputElement>, option?: IDropdownOption) =>\n                        onChange(\"resultsMergeStrategy\", option?.key)\n                    }\n                    aria-labelledby={includeCategoryId}\n                    options={[\n                        { key: \"interleaved\", text: t(\"labels.resultsMergeStrategyOptions.interleaved\") },\n                        { key: \"descending\", text: t(\"labels.resultsMergeStrategyOptions.descending\") }\n                    ]}\n                    onRenderLabel={props => renderLabel(props, includeCategoryId, includeCategoryFieldId, t(\"helpTexts.resultsMergeStrategy\"))}\n                />\n            )}\n\n            <TextField\n                id={retrieveCountFieldId}\n                className={styles.settingsSeparator}\n                label={t(\"labels.retrieveCount\")}\n                type=\"number\"\n                min={1}\n                max={50}\n                defaultValue={retrieveCount.toString()}\n                onChange={(_ev, val) => onChange(\"retrieveCount\", parseInt(val || \"3\"))}\n                aria-labelledby={retrieveCountId}\n                onRenderLabel={props => renderLabel(props, retrieveCountId, retrieveCountFieldId, t(\"helpTexts.retrieveNumber\"))}\n            />\n\n            <Dropdown\n                id={includeCategoryFieldId}\n                className={styles.settingsSeparator}\n                label={t(\"labels.includeCategory\")}\n                selectedKey={includeCategory}\n                onChange={(_ev?: React.FormEvent<HTMLElement | HTMLInputElement>, option?: IDropdownOption) => onChange(\"includeCategory\", option?.key || \"\")}\n                aria-labelledby={includeCategoryId}\n                options={[\n                    { key: \"\", text: t(\"labels.includeCategoryOptions.all\") }\n                    // { key: \"example\", text: \"Example Category\" } // Add more categories as needed\n                ]}\n                onRenderLabel={props => renderLabel(props, includeCategoryId, includeCategoryFieldId, t(\"helpTexts.includeCategory\"))}\n            />\n\n            <TextField\n                id={excludeCategoryFieldId}\n                className={styles.settingsSeparator}\n                label={t(\"labels.excludeCategory\")}\n                defaultValue={excludeCategory}\n                onChange={(_ev, val) => onChange(\"excludeCategory\", val || \"\")}\n                aria-labelledby={excludeCategoryId}\n                onRenderLabel={props => renderLabel(props, excludeCategoryId, excludeCategoryFieldId, t(\"helpTexts.excludeCategory\"))}\n            />\n\n            {showSemanticRankerOption && !useAgenticRetrieval && (\n                <>\n                    <Checkbox\n                        id={semanticRankerFieldId}\n                        className={styles.settingsSeparator}\n                        checked={useSemanticRanker}\n                        label={t(\"labels.useSemanticRanker\")}\n                        onChange={(_ev, checked) => onChange(\"useSemanticRanker\", !!checked)}\n                        aria-labelledby={semanticRankerId}\n                        onRenderLabel={props => renderLabel(props, semanticRankerId, semanticRankerFieldId, t(\"helpTexts.useSemanticReranker\"))}\n                    />\n\n                    <Checkbox\n                        id={semanticCaptionsFieldId}\n                        className={styles.settingsSeparator}\n                        checked={useSemanticCaptions}\n                        label={t(\"labels.useSemanticCaptions\")}\n                        onChange={(_ev, checked) => onChange(\"useSemanticCaptions\", !!checked)}\n                        disabled={!useSemanticRanker}\n                        aria-labelledby={semanticCaptionsId}\n                        onRenderLabel={props => renderLabel(props, semanticCaptionsId, semanticCaptionsFieldId, t(\"helpTexts.useSemanticCaptions\"))}\n                    />\n                </>\n            )}\n\n            {showQueryRewritingOption && !useAgenticRetrieval && (\n                <>\n                    <Checkbox\n                        id={queryRewritingFieldId}\n                        className={styles.settingsSeparator}\n                        checked={useQueryRewriting}\n                        disabled={!useSemanticRanker}\n                        label={t(\"labels.useQueryRewriting\")}\n                        onChange={(_ev, checked) => onChange(\"useQueryRewriting\", !!checked)}\n                        aria-labelledby={queryRewritingFieldId}\n                        onRenderLabel={props => renderLabel(props, queryRewritingFieldId, queryRewritingFieldId, t(\"helpTexts.useQueryRewriting\"))}\n                    />\n                </>\n            )}\n\n            {showReasoningEffortOption && (\n                <Dropdown\n                    id={reasoningEffortFieldId}\n                    selectedKey={reasoningEffort}\n                    label={t(\"labels.reasoningEffort\")}\n                    onChange={(_ev?: React.FormEvent<HTMLElement | HTMLInputElement>, option?: IDropdownOption) =>\n                        onChange(\"reasoningEffort\", option?.key || \"\")\n                    }\n                    aria-labelledby={reasoningEffortFieldId}\n                    options={[\n                        { key: \"low\", text: t(\"labels.reasoningEffortOptions.low\") },\n                        { key: \"medium\", text: t(\"labels.reasoningEffortOptions.medium\") },\n                        { key: \"high\", text: t(\"labels.reasoningEffortOptions.high\") }\n                    ]}\n                    onRenderLabel={props => renderLabel(props, queryRewritingFieldId, queryRewritingFieldId, t(\"helpTexts.reasoningEffort\"))}\n                />\n            )}\n\n            {useLogin && (\n                <>\n                    <Checkbox\n                        id={useOidSecurityFilterFieldId}\n                        className={styles.settingsSeparator}\n                        checked={useOidSecurityFilter || requireAccessControl}\n                        label={t(\"labels.useOidSecurityFilter\")}\n                        disabled={!loggedIn || requireAccessControl}\n                        onChange={(_ev, checked) => onChange(\"useOidSecurityFilter\", !!checked)}\n                        aria-labelledby={useOidSecurityFilterId}\n                        onRenderLabel={props => renderLabel(props, useOidSecurityFilterId, useOidSecurityFilterFieldId, t(\"helpTexts.useOidSecurityFilter\"))}\n                    />\n                    <Checkbox\n                        id={useGroupsSecurityFilterFieldId}\n                        className={styles.settingsSeparator}\n                        checked={useGroupsSecurityFilter || requireAccessControl}\n                        label={t(\"labels.useGroupsSecurityFilter\")}\n                        disabled={!loggedIn || requireAccessControl}\n                        onChange={(_ev, checked) => onChange(\"useGroupsSecurityFilter\", !!checked)}\n                        aria-labelledby={useGroupsSecurityFilterId}\n                        onRenderLabel={props =>\n                            renderLabel(props, useGroupsSecurityFilterId, useGroupsSecurityFilterFieldId, t(\"helpTexts.useGroupsSecurityFilter\"))\n                        }\n                    />\n                </>\n            )}\n\n            {showGPT4VOptions && !useAgenticRetrieval && (\n                <GPT4VSettings\n                    gpt4vInputs={gpt4vInput}\n                    isUseGPT4V={useGPT4V}\n                    updateUseGPT4V={val => onChange(\"useGPT4V\", val)}\n                    updateGPT4VInputs={val => onChange(\"gpt4vInput\", val)}\n                />\n            )}\n\n            {showVectorOption && !useAgenticRetrieval && (\n                <VectorSettings\n                    defaultRetrievalMode={retrievalMode}\n                    defaultVectorFields={vectorFields}\n                    showImageOptions={useGPT4V && showGPT4VOptions}\n                    updateVectorFields={val => onChange(\"vectorFields\", val)}\n                    updateRetrievalMode={val => onChange(\"retrievalMode\", val)}\n                />\n            )}\n\n            {/* Streaming checkbox for Chat */}\n            {shouldStream !== undefined && (\n                <Checkbox\n                    id={shouldStreamFieldId}\n                    disabled={!streamingEnabled}\n                    className={styles.settingsSeparator}\n                    checked={shouldStream}\n                    label={t(\"labels.shouldStream\")}\n                    onChange={(_ev, checked) => onChange(\"shouldStream\", !!checked)}\n                    aria-labelledby={shouldStreamId}\n                    onRenderLabel={props => renderLabel(props, shouldStreamId, shouldStreamFieldId, t(\"helpTexts.streamChat\"))}\n                />\n            )}\n\n            {/* Followup questions checkbox for Chat */}\n            {showSuggestFollowupQuestions && (\n                <Checkbox\n                    id={suggestFollowupQuestionsFieldId}\n                    className={styles.settingsSeparator}\n                    checked={useSuggestFollowupQuestions}\n                    label={t(\"labels.useSuggestFollowupQuestions\")}\n                    onChange={(_ev, checked) => onChange(\"useSuggestFollowupQuestions\", !!checked)}\n                    aria-labelledby={suggestFollowupQuestionsId}\n                    onRenderLabel={props =>\n                        renderLabel(props, suggestFollowupQuestionsId, suggestFollowupQuestionsFieldId, t(\"helpTexts.suggestFollowupQuestions\"))\n                    }\n                />\n            )}\n        </div>\n    );\n};\n","import { useRef, useState, useEffect, useContext } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Helmet } from \"react-helmet-async\";\nimport { Panel, DefaultButton } from \"@fluentui/react\";\nimport readNDJSONStream from \"ndjson-readablestream\";\n\nimport appLogo from \"../../assets/applogo.svg\";\nimport styles from \"./Chat.module.css\";\n\nimport {\n    chatApi,\n    configApi,\n    RetrievalMode,\n    ChatAppResponse,\n    ChatAppResponseOrError,\n    ChatAppRequest,\n    ResponseMessage,\n    VectorFields,\n    GPT4VInput,\n    SpeechConfig\n} from \"../../api\";\nimport { Answer, AnswerError, AnswerLoading } from \"../../components/Answer\";\nimport { QuestionInput } from \"../../components/QuestionInput\";\nimport { ExampleList } from \"../../components/Example\";\nimport { UserChatMessage } from \"../../components/UserChatMessage\";\nimport { AnalysisPanel, AnalysisPanelTabs } from \"../../components/AnalysisPanel\";\nimport { HistoryPanel } from \"../../components/HistoryPanel\";\nimport { HistoryProviderOptions, useHistoryManager } from \"../../components/HistoryProviders\";\nimport { HistoryButton } from \"../../components/HistoryButton\";\nimport { SettingsButton } from \"../../components/SettingsButton\";\nimport { ClearChatButton } from \"../../components/ClearChatButton\";\nimport { UploadFile } from \"../../components/UploadFile\";\nimport { useLogin, getToken, requireAccessControl } from \"../../authConfig\";\nimport { useMsal } from \"@azure/msal-react\";\nimport { TokenClaimsDisplay } from \"../../components/TokenClaimsDisplay\";\nimport { LoginContext } from \"../../loginContext\";\nimport { LanguagePicker } from \"../../i18n/LanguagePicker\";\nimport { Settings } from \"../../components/Settings/Settings\";\n\nconst Chat = () => {\n    const [isConfigPanelOpen, setIsConfigPanelOpen] = useState(false);\n    const [isHistoryPanelOpen, setIsHistoryPanelOpen] = useState(false);\n    const [promptTemplate, setPromptTemplate] = useState<string>(\"\");\n    const [temperature, setTemperature] = useState<number>(0.3);\n    const [seed, setSeed] = useState<number | null>(null);\n    const [minimumRerankerScore, setMinimumRerankerScore] = useState<number>(0);\n    const [minimumSearchScore, setMinimumSearchScore] = useState<number>(0);\n    const [retrieveCount, setRetrieveCount] = useState<number>(3);\n    const [maxSubqueryCount, setMaxSubqueryCount] = useState<number>(10);\n    const [resultsMergeStrategy, setResultsMergeStrategy] = useState<string>(\"interleaved\");\n    const [retrievalMode, setRetrievalMode] = useState<RetrievalMode>(RetrievalMode.Hybrid);\n    const [useSemanticRanker, setUseSemanticRanker] = useState<boolean>(true);\n    const [useQueryRewriting, setUseQueryRewriting] = useState<boolean>(false);\n    const [reasoningEffort, setReasoningEffort] = useState<string>(\"\");\n    const [streamingEnabled, setStreamingEnabled] = useState<boolean>(true);\n    const [shouldStream, setShouldStream] = useState<boolean>(true);\n    const [useSemanticCaptions, setUseSemanticCaptions] = useState<boolean>(false);\n    const [includeCategory, setIncludeCategory] = useState<string>(\"\");\n    const [excludeCategory, setExcludeCategory] = useState<string>(\"\");\n    const [useSuggestFollowupQuestions, setUseSuggestFollowupQuestions] = useState<boolean>(false);\n    const [vectorFields, setVectorFields] = useState<VectorFields>(VectorFields.TextAndImageEmbeddings);\n    const [useOidSecurityFilter, setUseOidSecurityFilter] = useState<boolean>(false);\n    const [useGroupsSecurityFilter, setUseGroupsSecurityFilter] = useState<boolean>(false);\n    const [gpt4vInput, setGPT4VInput] = useState<GPT4VInput>(GPT4VInput.TextAndImages);\n    const [useGPT4V, setUseGPT4V] = useState<boolean>(false);\n\n    const lastQuestionRef = useRef<string>(\"\");\n    const chatMessageStreamEnd = useRef<HTMLDivElement | null>(null);\n\n    const [isLoading, setIsLoading] = useState<boolean>(false);\n    const [isStreaming, setIsStreaming] = useState<boolean>(false);\n    const [error, setError] = useState<unknown>();\n\n    const [activeCitation, setActiveCitation] = useState<string>();\n    const [activeAnalysisPanelTab, setActiveAnalysisPanelTab] = useState<AnalysisPanelTabs | undefined>(undefined);\n\n    const [selectedAnswer, setSelectedAnswer] = useState<number>(0);\n    const [answers, setAnswers] = useState<[user: string, response: ChatAppResponse][]>([]);\n    const [streamedAnswers, setStreamedAnswers] = useState<[user: string, response: ChatAppResponse][]>([]);\n    const [speechUrls, setSpeechUrls] = useState<(string | null)[]>([]);\n\n    const [showGPT4VOptions, setShowGPT4VOptions] = useState<boolean>(false);\n    const [showSemanticRankerOption, setShowSemanticRankerOption] = useState<boolean>(false);\n    const [showQueryRewritingOption, setShowQueryRewritingOption] = useState<boolean>(false);\n    const [showReasoningEffortOption, setShowReasoningEffortOption] = useState<boolean>(false);\n    const [showVectorOption, setShowVectorOption] = useState<boolean>(false);\n    const [showUserUpload, setShowUserUpload] = useState<boolean>(false);\n    const [showLanguagePicker, setshowLanguagePicker] = useState<boolean>(false);\n    const [showSpeechInput, setShowSpeechInput] = useState<boolean>(false);\n    const [showSpeechOutputBrowser, setShowSpeechOutputBrowser] = useState<boolean>(false);\n    const [showSpeechOutputAzure, setShowSpeechOutputAzure] = useState<boolean>(false);\n    const [showChatHistoryBrowser, setShowChatHistoryBrowser] = useState<boolean>(false);\n    const [showChatHistoryCosmos, setShowChatHistoryCosmos] = useState<boolean>(false);\n    const [showAgenticRetrievalOption, setShowAgenticRetrievalOption] = useState<boolean>(false);\n    const [useAgenticRetrieval, setUseAgenticRetrieval] = useState<boolean>(false);\n\n    const audio = useRef(new Audio()).current;\n    const [isPlaying, setIsPlaying] = useState(false);\n\n    const speechConfig: SpeechConfig = {\n        speechUrls,\n        setSpeechUrls,\n        audio,\n        isPlaying,\n        setIsPlaying\n    };\n\n    const getConfig = async () => {\n        configApi().then(config => {\n            setShowGPT4VOptions(config.showGPT4VOptions);\n            if (config.showGPT4VOptions) {\n                setUseGPT4V(true);\n            }\n            setUseSemanticRanker(config.showSemanticRankerOption);\n            setShowSemanticRankerOption(config.showSemanticRankerOption);\n            setUseQueryRewriting(config.showQueryRewritingOption);\n            setShowQueryRewritingOption(config.showQueryRewritingOption);\n            setShowReasoningEffortOption(config.showReasoningEffortOption);\n            setStreamingEnabled(config.streamingEnabled);\n            if (!config.streamingEnabled) {\n                setShouldStream(false);\n            }\n            if (config.showReasoningEffortOption) {\n                setReasoningEffort(config.defaultReasoningEffort);\n            }\n            setShowVectorOption(config.showVectorOption);\n            if (!config.showVectorOption) {\n                setRetrievalMode(RetrievalMode.Text);\n            }\n            setShowUserUpload(config.showUserUpload);\n            setshowLanguagePicker(config.showLanguagePicker);\n            setShowSpeechInput(config.showSpeechInput);\n            setShowSpeechOutputBrowser(config.showSpeechOutputBrowser);\n            setShowSpeechOutputAzure(config.showSpeechOutputAzure);\n            setShowChatHistoryBrowser(config.showChatHistoryBrowser);\n            setShowChatHistoryCosmos(config.showChatHistoryCosmos);\n            setShowAgenticRetrievalOption(config.showAgenticRetrievalOption);\n            setUseAgenticRetrieval(config.showAgenticRetrievalOption);\n            if (config.showAgenticRetrievalOption) {\n                setRetrieveCount(10);\n            }\n        });\n    };\n\n    const handleAsyncRequest = async (question: string, answers: [string, ChatAppResponse][], responseBody: ReadableStream<any>) => {\n        let answer: string = \"\";\n        let askResponse: ChatAppResponse = {} as ChatAppResponse;\n\n        const updateState = (newContent: string) => {\n            return new Promise(resolve => {\n                setTimeout(() => {\n                    answer += newContent;\n                    const latestResponse: ChatAppResponse = {\n                        ...askResponse,\n                        message: { content: answer, role: askResponse.message.role }\n                    };\n                    setStreamedAnswers([...answers, [question, latestResponse]]);\n                    resolve(null);\n                }, 33);\n            });\n        };\n        try {\n            setIsStreaming(true);\n            for await (const event of readNDJSONStream(responseBody)) {\n                if (event[\"context\"] && event[\"context\"][\"data_points\"]) {\n                    event[\"message\"] = event[\"delta\"];\n                    askResponse = event as ChatAppResponse;\n                } else if (event[\"delta\"] && event[\"delta\"][\"content\"]) {\n                    setIsLoading(false);\n                    await updateState(event[\"delta\"][\"content\"]);\n                } else if (event[\"context\"]) {\n                    // Update context with new keys from latest event\n                    askResponse.context = { ...askResponse.context, ...event[\"context\"] };\n                } else if (event[\"error\"]) {\n                    throw Error(event[\"error\"]);\n                }\n            }\n        } finally {\n            setIsStreaming(false);\n        }\n        const fullResponse: ChatAppResponse = {\n            ...askResponse,\n            message: { content: answer, role: askResponse.message.role }\n        };\n        return fullResponse;\n    };\n\n    const client = useLogin ? useMsal().instance : undefined;\n    const { loggedIn } = useContext(LoginContext);\n\n    const historyProvider: HistoryProviderOptions = (() => {\n        if (useLogin && showChatHistoryCosmos) return HistoryProviderOptions.CosmosDB;\n        if (showChatHistoryBrowser) return HistoryProviderOptions.IndexedDB;\n        return HistoryProviderOptions.None;\n    })();\n    const historyManager = useHistoryManager(historyProvider);\n\n    const makeApiRequest = async (question: string) => {\n        lastQuestionRef.current = question;\n\n        error && setError(undefined);\n        setIsLoading(true);\n        setActiveCitation(undefined);\n        setActiveAnalysisPanelTab(undefined);\n\n        const token = client ? await getToken(client) : undefined;\n\n        try {\n            const messages: ResponseMessage[] = answers.flatMap(a => [\n                { content: a[0], role: \"user\" },\n                { content: a[1].message.content, role: \"assistant\" }\n            ]);\n\n            const request: ChatAppRequest = {\n                messages: [...messages, { content: question, role: \"user\" }],\n                context: {\n                    overrides: {\n                        prompt_template: promptTemplate.length === 0 ? undefined : promptTemplate,\n                        include_category: includeCategory.length === 0 ? undefined : includeCategory,\n                        exclude_category: excludeCategory.length === 0 ? undefined : excludeCategory,\n                        top: retrieveCount,\n                        max_subqueries: maxSubqueryCount,\n                        results_merge_strategy: resultsMergeStrategy,\n                        temperature: temperature,\n                        minimum_reranker_score: minimumRerankerScore,\n                        minimum_search_score: minimumSearchScore,\n                        retrieval_mode: retrievalMode,\n                        semantic_ranker: useSemanticRanker,\n                        semantic_captions: useSemanticCaptions,\n                        query_rewriting: useQueryRewriting,\n                        reasoning_effort: reasoningEffort,\n                        suggest_followup_questions: useSuggestFollowupQuestions,\n                        use_oid_security_filter: useOidSecurityFilter,\n                        use_groups_security_filter: useGroupsSecurityFilter,\n                        vector_fields: vectorFields,\n                        use_gpt4v: useGPT4V,\n                        gpt4v_input: gpt4vInput,\n                        language: i18n.language,\n                        use_agentic_retrieval: useAgenticRetrieval,\n                        ...(seed !== null ? { seed: seed } : {})\n                    }\n                },\n                // AI Chat Protocol: Client must pass on any session state received from the server\n                session_state: answers.length ? answers[answers.length - 1][1].session_state : null\n            };\n\n            const response = await chatApi(request, shouldStream, token);\n            if (!response.body) {\n                throw Error(\"No response body\");\n            }\n            if (response.status > 299 || !response.ok) {\n                throw Error(`Request failed with status ${response.status}`);\n            }\n            if (shouldStream) {\n                const parsedResponse: ChatAppResponse = await handleAsyncRequest(question, answers, response.body);\n                setAnswers([...answers, [question, parsedResponse]]);\n                if (typeof parsedResponse.session_state === \"string\" && parsedResponse.session_state !== \"\") {\n                    const token = client ? await getToken(client) : undefined;\n                    historyManager.addItem(parsedResponse.session_state, [...answers, [question, parsedResponse]], token);\n                }\n            } else {\n                const parsedResponse: ChatAppResponseOrError = await response.json();\n                if (parsedResponse.error) {\n                    throw Error(parsedResponse.error);\n                }\n                setAnswers([...answers, [question, parsedResponse as ChatAppResponse]]);\n                if (typeof parsedResponse.session_state === \"string\" && parsedResponse.session_state !== \"\") {\n                    const token = client ? await getToken(client) : undefined;\n                    historyManager.addItem(parsedResponse.session_state, [...answers, [question, parsedResponse as ChatAppResponse]], token);\n                }\n            }\n            setSpeechUrls([...speechUrls, null]);\n        } catch (e) {\n            setError(e);\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    const clearChat = () => {\n        lastQuestionRef.current = \"\";\n        error && setError(undefined);\n        setActiveCitation(undefined);\n        setActiveAnalysisPanelTab(undefined);\n        setAnswers([]);\n        setSpeechUrls([]);\n        setStreamedAnswers([]);\n        setIsLoading(false);\n        setIsStreaming(false);\n    };\n\n    useEffect(() => chatMessageStreamEnd.current?.scrollIntoView({ behavior: \"smooth\" }), [isLoading]);\n    useEffect(() => chatMessageStreamEnd.current?.scrollIntoView({ behavior: \"auto\" }), [streamedAnswers]);\n    useEffect(() => {\n        getConfig();\n    }, []);\n\n    const handleSettingsChange = (field: string, value: any) => {\n        switch (field) {\n            case \"promptTemplate\":\n                setPromptTemplate(value);\n                break;\n            case \"temperature\":\n                setTemperature(value);\n                break;\n            case \"seed\":\n                setSeed(value);\n                break;\n            case \"minimumRerankerScore\":\n                setMinimumRerankerScore(value);\n                break;\n            case \"minimumSearchScore\":\n                setMinimumSearchScore(value);\n                break;\n            case \"retrieveCount\":\n                setRetrieveCount(value);\n                break;\n            case \"maxSubqueryCount\":\n                setMaxSubqueryCount(value);\n                break;\n            case \"resultsMergeStrategy\":\n                setResultsMergeStrategy(value);\n                break;\n            case \"useSemanticRanker\":\n                setUseSemanticRanker(value);\n                break;\n            case \"useQueryRewriting\":\n                setUseQueryRewriting(value);\n                break;\n            case \"reasoningEffort\":\n                setReasoningEffort(value);\n                break;\n            case \"useSemanticCaptions\":\n                setUseSemanticCaptions(value);\n                break;\n            case \"excludeCategory\":\n                setExcludeCategory(value);\n                break;\n            case \"includeCategory\":\n                setIncludeCategory(value);\n                break;\n            case \"useOidSecurityFilter\":\n                setUseOidSecurityFilter(value);\n                break;\n            case \"useGroupsSecurityFilter\":\n                setUseGroupsSecurityFilter(value);\n                break;\n            case \"shouldStream\":\n                setShouldStream(value);\n                break;\n            case \"useSuggestFollowupQuestions\":\n                setUseSuggestFollowupQuestions(value);\n                break;\n            case \"useGPT4V\":\n                setUseGPT4V(value);\n                break;\n            case \"gpt4vInput\":\n                setGPT4VInput(value);\n                break;\n            case \"vectorFields\":\n                setVectorFields(value);\n                break;\n            case \"retrievalMode\":\n                setRetrievalMode(value);\n                break;\n            case \"useAgenticRetrieval\":\n                setUseAgenticRetrieval(value);\n        }\n    };\n\n    const onExampleClicked = (example: string) => {\n        makeApiRequest(example);\n    };\n\n    const onShowCitation = (citation: string, index: number) => {\n        if (activeCitation === citation && activeAnalysisPanelTab === AnalysisPanelTabs.CitationTab && selectedAnswer === index) {\n            setActiveAnalysisPanelTab(undefined);\n        } else {\n            setActiveCitation(citation);\n            setActiveAnalysisPanelTab(AnalysisPanelTabs.CitationTab);\n        }\n\n        setSelectedAnswer(index);\n    };\n\n    const onToggleTab = (tab: AnalysisPanelTabs, index: number) => {\n        if (activeAnalysisPanelTab === tab && selectedAnswer === index) {\n            setActiveAnalysisPanelTab(undefined);\n        } else {\n            setActiveAnalysisPanelTab(tab);\n        }\n\n        setSelectedAnswer(index);\n    };\n\n    const { t, i18n } = useTranslation();\n\n    return (\n        <div className={styles.container}>\n            {/* Setting the page title using react-helmet-async */}\n            <Helmet>\n                <title>{t(\"pageTitle\")}</title>\n            </Helmet>\n            <div className={styles.commandsSplitContainer}>\n                <div className={styles.commandsContainer}>\n                    {((useLogin && showChatHistoryCosmos) || showChatHistoryBrowser) && (\n                        <HistoryButton className={styles.commandButton} onClick={() => setIsHistoryPanelOpen(!isHistoryPanelOpen)} />\n                    )}\n                </div>\n                <div className={styles.commandsContainer}>\n                    <ClearChatButton className={styles.commandButton} onClick={clearChat} disabled={!lastQuestionRef.current || isLoading} />\n                    {showUserUpload && <UploadFile className={styles.commandButton} disabled={!loggedIn} />}\n                    <SettingsButton className={styles.commandButton} onClick={() => setIsConfigPanelOpen(!isConfigPanelOpen)} />\n                </div>\n            </div>\n            <div className={styles.chatRoot} style={{ marginLeft: isHistoryPanelOpen ? \"300px\" : \"0\" }}>\n                <div className={styles.chatContainer}>\n                    {!lastQuestionRef.current ? (\n                        <div className={styles.chatEmptyState}>\n                            <img src={appLogo} alt=\"App logo\" width=\"120\" height=\"120\" />\n\n                            <h1 className={styles.chatEmptyStateTitle}>{t(\"chatEmptyStateTitle\")}</h1>\n                            <h2 className={styles.chatEmptyStateSubtitle}>{t(\"chatEmptyStateSubtitle\")}</h2>\n                            {showLanguagePicker && <LanguagePicker onLanguageChange={newLang => i18n.changeLanguage(newLang)} />}\n\n                            <ExampleList onExampleClicked={onExampleClicked} useGPT4V={useGPT4V} />\n                        </div>\n                    ) : (\n                        <div className={styles.chatMessageStream}>\n                            {isStreaming &&\n                                streamedAnswers.map((streamedAnswer, index) => (\n                                    <div key={index}>\n                                        <UserChatMessage message={streamedAnswer[0]} />\n                                        <div className={styles.chatMessageGpt}>\n                                            <Answer\n                                                isStreaming={true}\n                                                key={index}\n                                                answer={streamedAnswer[1]}\n                                                index={index}\n                                                speechConfig={speechConfig}\n                                                isSelected={false}\n                                                onCitationClicked={c => onShowCitation(c, index)}\n                                                onThoughtProcessClicked={() => onToggleTab(AnalysisPanelTabs.ThoughtProcessTab, index)}\n                                                onSupportingContentClicked={() => onToggleTab(AnalysisPanelTabs.SupportingContentTab, index)}\n                                                onFollowupQuestionClicked={q => makeApiRequest(q)}\n                                                showFollowupQuestions={useSuggestFollowupQuestions && answers.length - 1 === index}\n                                                showSpeechOutputAzure={showSpeechOutputAzure}\n                                                showSpeechOutputBrowser={showSpeechOutputBrowser}\n                                            />\n                                        </div>\n                                    </div>\n                                ))}\n                            {!isStreaming &&\n                                answers.map((answer, index) => (\n                                    <div key={index}>\n                                        <UserChatMessage message={answer[0]} />\n                                        <div className={styles.chatMessageGpt}>\n                                            <Answer\n                                                isStreaming={false}\n                                                key={index}\n                                                answer={answer[1]}\n                                                index={index}\n                                                speechConfig={speechConfig}\n                                                isSelected={selectedAnswer === index && activeAnalysisPanelTab !== undefined}\n                                                onCitationClicked={c => onShowCitation(c, index)}\n                                                onThoughtProcessClicked={() => onToggleTab(AnalysisPanelTabs.ThoughtProcessTab, index)}\n                                                onSupportingContentClicked={() => onToggleTab(AnalysisPanelTabs.SupportingContentTab, index)}\n                                                onFollowupQuestionClicked={q => makeApiRequest(q)}\n                                                showFollowupQuestions={useSuggestFollowupQuestions && answers.length - 1 === index}\n                                                showSpeechOutputAzure={showSpeechOutputAzure}\n                                                showSpeechOutputBrowser={showSpeechOutputBrowser}\n                                            />\n                                        </div>\n                                    </div>\n                                ))}\n                            {isLoading && (\n                                <>\n                                    <UserChatMessage message={lastQuestionRef.current} />\n                                    <div className={styles.chatMessageGptMinWidth}>\n                                        <AnswerLoading />\n                                    </div>\n                                </>\n                            )}\n                            {error ? (\n                                <>\n                                    <UserChatMessage message={lastQuestionRef.current} />\n                                    <div className={styles.chatMessageGptMinWidth}>\n                                        <AnswerError error={error.toString()} onRetry={() => makeApiRequest(lastQuestionRef.current)} />\n                                    </div>\n                                </>\n                            ) : null}\n                            <div ref={chatMessageStreamEnd} />\n                        </div>\n                    )}\n\n                    <div className={styles.chatInput}>\n                        <QuestionInput\n                            clearOnSend\n                            placeholder={t(\"defaultExamples.placeholder\")}\n                            disabled={isLoading}\n                            onSend={question => makeApiRequest(question)}\n                            showSpeechInput={showSpeechInput}\n                        />\n                    </div>\n                </div>\n\n                {answers.length > 0 && activeAnalysisPanelTab && (\n                    <AnalysisPanel\n                        className={styles.chatAnalysisPanel}\n                        activeCitation={activeCitation}\n                        onActiveTabChanged={x => onToggleTab(x, selectedAnswer)}\n                        citationHeight=\"810px\"\n                        answer={answers[selectedAnswer][1]}\n                        activeTab={activeAnalysisPanelTab}\n                    />\n                )}\n\n                {((useLogin && showChatHistoryCosmos) || showChatHistoryBrowser) && (\n                    <HistoryPanel\n                        provider={historyProvider}\n                        isOpen={isHistoryPanelOpen}\n                        notify={!isStreaming && !isLoading}\n                        onClose={() => setIsHistoryPanelOpen(false)}\n                        onChatSelected={answers => {\n                            if (answers.length === 0) return;\n                            setAnswers(answers);\n                            lastQuestionRef.current = answers[answers.length - 1][0];\n                        }}\n                    />\n                )}\n\n                <Panel\n                    headerText={t(\"labels.headerText\")}\n                    isOpen={isConfigPanelOpen}\n                    isBlocking={false}\n                    onDismiss={() => setIsConfigPanelOpen(false)}\n                    closeButtonAriaLabel={t(\"labels.closeButton\")}\n                    onRenderFooterContent={() => <DefaultButton onClick={() => setIsConfigPanelOpen(false)}>{t(\"labels.closeButton\")}</DefaultButton>}\n                    isFooterAtBottom={true}\n                >\n                    <Settings\n                        promptTemplate={promptTemplate}\n                        temperature={temperature}\n                        retrieveCount={retrieveCount}\n                        maxSubqueryCount={maxSubqueryCount}\n                        resultsMergeStrategy={resultsMergeStrategy}\n                        seed={seed}\n                        minimumSearchScore={minimumSearchScore}\n                        minimumRerankerScore={minimumRerankerScore}\n                        useSemanticRanker={useSemanticRanker}\n                        useSemanticCaptions={useSemanticCaptions}\n                        useQueryRewriting={useQueryRewriting}\n                        reasoningEffort={reasoningEffort}\n                        excludeCategory={excludeCategory}\n                        includeCategory={includeCategory}\n                        retrievalMode={retrievalMode}\n                        useGPT4V={useGPT4V}\n                        gpt4vInput={gpt4vInput}\n                        vectorFields={vectorFields}\n                        showSemanticRankerOption={showSemanticRankerOption}\n                        showQueryRewritingOption={showQueryRewritingOption}\n                        showReasoningEffortOption={showReasoningEffortOption}\n                        showGPT4VOptions={showGPT4VOptions}\n                        showVectorOption={showVectorOption}\n                        useOidSecurityFilter={useOidSecurityFilter}\n                        useGroupsSecurityFilter={useGroupsSecurityFilter}\n                        useLogin={!!useLogin}\n                        loggedIn={loggedIn}\n                        requireAccessControl={requireAccessControl}\n                        shouldStream={shouldStream}\n                        streamingEnabled={streamingEnabled}\n                        useSuggestFollowupQuestions={useSuggestFollowupQuestions}\n                        showSuggestFollowupQuestions={true}\n                        showAgenticRetrievalOption={showAgenticRetrievalOption}\n                        useAgenticRetrieval={useAgenticRetrieval}\n                        onChange={handleSettingsChange}\n                    />\n                    {useLogin && <TokenClaimsDisplay />}\n                </Panel>\n            </div>\n        </div>\n    );\n};\n\nexport default Chat;\n","import { DefaultButton } from \"@fluentui/react\";\nimport { useMsal } from \"@azure/msal-react\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./LoginButton.module.css\";\nimport { getRedirectUri, loginRequest, appServicesLogout, getUsername, checkLoggedIn } from \"../../authConfig\";\nimport { useState, useEffect, useContext } from \"react\";\nimport { LoginContext } from \"../../loginContext\";\n\nexport const LoginButton = () => {\n    const { instance } = useMsal();\n    const { loggedIn, setLoggedIn } = useContext(LoginContext);\n    const activeAccount = instance.getActiveAccount();\n    const [username, setUsername] = useState(\"\");\n    const { t } = useTranslation();\n\n    useEffect(() => {\n        const fetchUsername = async () => {\n            setUsername((await getUsername(instance)) ?? \"\");\n        };\n\n        fetchUsername();\n    }, []);\n\n    const handleLoginPopup = () => {\n        /**\n         * When using popup and silent APIs, we recommend setting the redirectUri to a blank page or a page\n         * that does not implement MSAL. Keep in mind that all redirect routes must be registered with the application\n         * For more information, please follow this link: https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-browser/docs/login-user.md#redirecturi-considerations\n         */\n        instance\n            .loginPopup({\n                ...loginRequest,\n                redirectUri: getRedirectUri()\n            })\n            .catch(error => console.log(error))\n            .then(async () => {\n                setLoggedIn(await checkLoggedIn(instance));\n                setUsername((await getUsername(instance)) ?? \"\");\n            });\n    };\n    const handleLogoutPopup = () => {\n        if (activeAccount) {\n            instance\n                .logoutPopup({\n                    mainWindowRedirectUri: \"/\", // redirects the top level app after logout\n                    account: instance.getActiveAccount()\n                })\n                .catch(error => console.log(error))\n                .then(async () => {\n                    setLoggedIn(await checkLoggedIn(instance));\n                    setUsername((await getUsername(instance)) ?? \"\");\n                });\n        } else {\n            appServicesLogout();\n        }\n    };\n    return (\n        <DefaultButton\n            text={loggedIn ? `${t(\"logout\")}\\n${username}` : `${t(\"login\")}`}\n            className={styles.loginButton}\n            onClick={loggedIn ? handleLogoutPopup : handleLoginPopup}\n        ></DefaultButton>\n    );\n};\n","import React, { useState, useEffect, useRef, RefObject } from \"react\";\nimport { Outlet, NavLink, Link } from \"react-router-dom\";\nimport { useTranslation } from \"react-i18next\";\nimport styles from \"./Layout.module.css\";\n\nimport { useLogin } from \"../../authConfig\";\n\nimport { LoginButton } from \"../../components/LoginButton\";\nimport { IconButton } from \"@fluentui/react\";\n\nconst Layout = () => {\n    const { t } = useTranslation();\n    const [menuOpen, setMenuOpen] = useState(false);\n    const menuRef: RefObject<HTMLDivElement> = useRef(null);\n\n    const toggleMenu = () => {\n        setMenuOpen(!menuOpen);\n    };\n\n    const handleClickOutside = (event: MouseEvent) => {\n        if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n            setMenuOpen(false);\n        }\n    };\n\n    useEffect(() => {\n        if (menuOpen) {\n            document.addEventListener(\"mousedown\", handleClickOutside);\n        } else {\n            document.removeEventListener(\"mousedown\", handleClickOutside);\n        }\n        return () => {\n            document.removeEventListener(\"mousedown\", handleClickOutside);\n        };\n    }, [menuOpen]);\n\n    return (\n        <div className={styles.layout}>\n            <header className={styles.header} role={\"banner\"}>\n                <div className={styles.headerContainer} ref={menuRef}>\n                    <Link to=\"/\" className={styles.headerTitleContainer}>\n                        <h3 className={styles.headerTitle}>{t(\"headerTitle\")}</h3>\n                    </Link>\n                    <nav>\n                        <ul className={`${styles.headerNavList} ${menuOpen ? styles.show : \"\"}`}>\n                            <li>\n                                <NavLink\n                                    to=\"/\"\n                                    className={({ isActive }) => (isActive ? styles.headerNavPageLinkActive : styles.headerNavPageLink)}\n                                    onClick={() => setMenuOpen(false)}\n                                >\n                                    {t(\"chat\")}\n                                </NavLink>\n                            </li>\n                            <li>\n                                <NavLink\n                                    to=\"/qa\"\n                                    className={({ isActive }) => (isActive ? styles.headerNavPageLinkActive : styles.headerNavPageLink)}\n                                    onClick={() => setMenuOpen(false)}\n                                >\n                                    {t(\"qa\")}\n                                </NavLink>\n                            </li>\n                        </ul>\n                    </nav>\n                    <div className={styles.loginMenuContainer}>\n                        {useLogin && <LoginButton />}\n                        <IconButton\n                            iconProps={{ iconName: \"GlobalNavButton\" }}\n                            className={styles.menuToggle}\n                            onClick={toggleMenu}\n                            ariaLabel={t(\"labels.toggleMenu\")}\n                        />\n                    </div>\n                </div>\n            </header>\n\n            <Outlet />\n        </div>\n    );\n};\n\nexport default Layout;\n","import { AccountInfo, EventType, PublicClientApplication } from \"@azure/msal-browser\";\nimport { checkLoggedIn, msalConfig, useLogin } from \"./authConfig\";\nimport { useEffect, useState } from \"react\";\nimport { MsalProvider } from \"@azure/msal-react\";\nimport { LoginContext } from \"./loginContext\";\nimport Layout from \"./pages/layout/Layout\";\n\nconst LayoutWrapper = () => {\n    const [loggedIn, setLoggedIn] = useState(false);\n    if (useLogin) {\n        var msalInstance = new PublicClientApplication(msalConfig);\n\n        // Default to using the first account if no account is active on page load\n        if (!msalInstance.getActiveAccount() && msalInstance.getAllAccounts().length > 0) {\n            // Account selection logic is app dependent. Adjust as needed for different use cases.\n            msalInstance.setActiveAccount(msalInstance.getActiveAccount());\n        }\n\n        // Listen for sign-in event and set active account\n        msalInstance.addEventCallback(event => {\n            if (event.eventType === EventType.LOGIN_SUCCESS && event.payload) {\n                const account = event.payload as AccountInfo;\n                msalInstance.setActiveAccount(account);\n            }\n        });\n\n        useEffect(() => {\n            const fetchLoggedIn = async () => {\n                setLoggedIn(await checkLoggedIn(msalInstance));\n            };\n\n            fetchLoggedIn();\n        }, []);\n\n        return (\n            <MsalProvider instance={msalInstance}>\n                <LoginContext.Provider\n                    value={{\n                        loggedIn,\n                        setLoggedIn\n                    }}\n                >\n                    <Layout />\n                </LoginContext.Provider>\n            </MsalProvider>\n        );\n    } else {\n        return (\n            <LoginContext.Provider\n                value={{\n                    loggedIn,\n                    setLoggedIn\n                }}\n            >\n                <Layout />\n            </LoginContext.Provider>\n        );\n    }\n};\n\nexport default LayoutWrapper;\n","import React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport { createHashRouter, RouterProvider } from \"react-router-dom\";\nimport { I18nextProvider } from \"react-i18next\";\nimport { HelmetProvider } from \"react-helmet-async\";\nimport { initializeIcons } from \"@fluentui/react\";\n\nimport \"./index.css\";\n\nimport Chat from \"./pages/chat/Chat\";\nimport LayoutWrapper from \"./layoutWrapper\";\nimport i18next from \"./i18n/config\";\n\ninitializeIcons();\n\nconst router = createHashRouter([\n    {\n        path: \"/\",\n        element: <LayoutWrapper />,\n        children: [\n            {\n                index: true,\n                element: <Chat />\n            },\n            {\n                path: \"qa\",\n                lazy: () => import(\"./pages/ask/Ask\")\n            },\n            {\n                path: \"*\",\n                lazy: () => import(\"./pages/NoPage\")\n            }\n        ]\n    }\n]);\n\nReactDOM.createRoot(document.getElementById(\"root\") as HTMLElement).render(\n    <React.StrictMode>\n        <I18nextProvider i18n={i18next}>\n            <HelmetProvider>\n                <RouterProvider router={router} />\n            </HelmetProvider>\n        </I18nextProvider>\n    </React.StrictMode>\n);\n"],"file":"assets/index-EDs62pof.js"}